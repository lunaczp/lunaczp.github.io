<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PERFORMANCE SCHEMA: table_def Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PERFORMANCE SCHEMA
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classtable__def-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">table_def Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="rpl__utility_8h_source.html">rpl_utility.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a659c3d889db3ab3c2cc3f3cb591587e5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtable__def.html#a659c3d889db3ab3c2cc3f3cb591587e5">table_def</a> (unsigned char *types, ulong <a class="el" href="classtable__def.html#a793dcd937355e094a90d55e2e1bca1c4">size</a>, uchar *field_metadata, int metadata_size, uchar *null_bitmap, uint16 <a class="el" href="handler0alter_8cc.html#a4069e5feb5d17fbac4d832518d169cdd">flags</a>)</td></tr>
<tr class="separator:a659c3d889db3ab3c2cc3f3cb591587e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a793dcd937355e094a90d55e2e1bca1c4"><td class="memItemLeft" align="right" valign="top">ulong&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtable__def.html#a793dcd937355e094a90d55e2e1bca1c4">size</a> () const</td></tr>
<tr class="separator:a793dcd937355e094a90d55e2e1bca1c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa9c2710f4c4bc50ef6307226eb276cb4"><td class="memItemLeft" align="right" valign="top"><a id="aa9c2710f4c4bc50ef6307226eb276cb4"></a>
enum_field_types&#160;</td><td class="memItemRight" valign="bottom"><b>binlog_type</b> (ulong <a class="el" href="row0upd_8cc.html#a4ddeaa41a4dab23a7eaa06ee52e4522b">index</a>) const</td></tr>
<tr class="separator:aa9c2710f4c4bc50ef6307226eb276cb4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ea2417ae94fbad9428f7fe96a385953"><td class="memItemLeft" align="right" valign="top"><a id="a3ea2417ae94fbad9428f7fe96a385953"></a>
enum_field_types&#160;</td><td class="memItemRight" valign="bottom"><b>type</b> (ulong <a class="el" href="row0upd_8cc.html#a4ddeaa41a4dab23a7eaa06ee52e4522b">index</a>) const</td></tr>
<tr class="separator:a3ea2417ae94fbad9428f7fe96a385953"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac21e2a53311720f21828abdd20978223"><td class="memItemLeft" align="right" valign="top"><a id="ac21e2a53311720f21828abdd20978223"></a>
uint16&#160;</td><td class="memItemRight" valign="bottom"><b>field_metadata</b> (uint <a class="el" href="row0upd_8cc.html#a4ddeaa41a4dab23a7eaa06ee52e4522b">index</a>) const</td></tr>
<tr class="separator:ac21e2a53311720f21828abdd20978223"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a261962eba5092696b8a29cff0c8874f1"><td class="memItemLeft" align="right" valign="top"><a id="a261962eba5092696b8a29cff0c8874f1"></a>
my_bool&#160;</td><td class="memItemRight" valign="bottom"><b>maybe_null</b> (uint <a class="el" href="row0upd_8cc.html#a4ddeaa41a4dab23a7eaa06ee52e4522b">index</a>) const</td></tr>
<tr class="separator:a261962eba5092696b8a29cff0c8874f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab06efb289dfb4b090bb9d25986577191"><td class="memItemLeft" align="right" valign="top"><a id="ab06efb289dfb4b090bb9d25986577191"></a>
uint32&#160;</td><td class="memItemRight" valign="bottom"><b>calc_field_size</b> (uint col, uchar *master_data) const</td></tr>
<tr class="separator:ab06efb289dfb4b090bb9d25986577191"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aedd263d15199083d64b5ba5beaf1eb5a"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtable__def.html#aedd263d15199083d64b5ba5beaf1eb5a">compatible_with</a> (THD *<a class="el" href="row0quiesce_8cc.html#a75b6f5ba5a17ae9fb524f56a5eed51cb">thd</a>, <a class="el" href="class_relay__log__info.html">Relay_log_info</a> *rli, <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> *<a class="el" href="row0upd_8cc.html#ab172ed3d3d31ff02fc5f798fe7e1bfb8">table</a>, <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> **conv_table_var) const</td></tr>
<tr class="separator:aedd263d15199083d64b5ba5beaf1eb5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a07dbe69aabbf2c897317a2c96648a4a8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_t_a_b_l_e.html">TABLE</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtable__def.html#a07dbe69aabbf2c897317a2c96648a4a8">create_conversion_table</a> (THD *<a class="el" href="row0quiesce_8cc.html#a75b6f5ba5a17ae9fb524f56a5eed51cb">thd</a>, <a class="el" href="class_relay__log__info.html">Relay_log_info</a> *rli, <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> *target_table) const</td></tr>
<tr class="separator:a07dbe69aabbf2c897317a2c96648a4a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a1a23d5be5e853c29c849cd9580aa3f7e"><td class="memItemLeft" align="right" valign="top"><a id="a1a23d5be5e853c29c849cd9580aa3f7e"></a>
ulong&#160;</td><td class="memItemRight" valign="bottom"><b>m_size</b></td></tr>
<tr class="separator:a1a23d5be5e853c29c849cd9580aa3f7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79acc038cbea32233f3c9d43f3e16c29"><td class="memItemLeft" align="right" valign="top"><a id="a79acc038cbea32233f3c9d43f3e16c29"></a>
unsigned char *&#160;</td><td class="memItemRight" valign="bottom"><b>m_type</b></td></tr>
<tr class="separator:a79acc038cbea32233f3c9d43f3e16c29"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81ce072a027cc5dd0996023230045dfd"><td class="memItemLeft" align="right" valign="top"><a id="a81ce072a027cc5dd0996023230045dfd"></a>
uint&#160;</td><td class="memItemRight" valign="bottom"><b>m_field_metadata_size</b></td></tr>
<tr class="separator:a81ce072a027cc5dd0996023230045dfd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9925258f808e5caf1e8cd3dd6d6e6b2b"><td class="memItemLeft" align="right" valign="top"><a id="a9925258f808e5caf1e8cd3dd6d6e6b2b"></a>
uint16 *&#160;</td><td class="memItemRight" valign="bottom"><b>m_field_metadata</b></td></tr>
<tr class="separator:a9925258f808e5caf1e8cd3dd6d6e6b2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af15d119b17614e2c56cd142b258a0bd2"><td class="memItemLeft" align="right" valign="top"><a id="af15d119b17614e2c56cd142b258a0bd2"></a>
uchar *&#160;</td><td class="memItemRight" valign="bottom"><b>m_null_bits</b></td></tr>
<tr class="separator:af15d119b17614e2c56cd142b258a0bd2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac24bd985337c33048748d794709c092"><td class="memItemLeft" align="right" valign="top"><a id="aac24bd985337c33048748d794709c092"></a>
uint16&#160;</td><td class="memItemRight" valign="bottom"><b>m_flags</b></td></tr>
<tr class="separator:aac24bd985337c33048748d794709c092"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a60684fb65fc75e37bf788075c0e77d4d"><td class="memItemLeft" align="right" valign="top"><a id="a60684fb65fc75e37bf788075c0e77d4d"></a>
uchar *&#160;</td><td class="memItemRight" valign="bottom"><b>m_memory</b></td></tr>
<tr class="separator:a60684fb65fc75e37bf788075c0e77d4d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A table definition from the master.</p>
<p>The responsibilities of this class is:</p><ul>
<li>Extract and decode table definition data from the table map event</li>
<li><a class="el" href="struct_check.html">Check</a> if table definition in table map is compatible with table definition on slave </li>
</ul>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a659c3d889db3ab3c2cc3f3cb591587e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a659c3d889db3ab3c2cc3f3cb591587e5">&#9670;&nbsp;</a></span>table_def()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">table_def::table_def </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>types</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ulong&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uchar *&#160;</td>
          <td class="paramname"><em>field_metadata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>metadata_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uchar *&#160;</td>
          <td class="paramname"><em>null_bitmap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Constructor.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">types</td><td>Array of types, each stored as a byte </td></tr>
    <tr><td class="paramname">size</td><td>Number of elements in array 'types' </td></tr>
    <tr><td class="paramname">field_metadata</td><td>Array of extra information about fields </td></tr>
    <tr><td class="paramname">metadata_size</td><td>Size of the field_metadata array </td></tr>
    <tr><td class="paramname">null_bitmap</td><td>The bitmap of fields that can be null </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="aedd263d15199083d64b5ba5beaf1eb5a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aedd263d15199083d64b5ba5beaf1eb5a">&#9670;&nbsp;</a></span>compatible_with()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool table_def::compatible_with </td>
          <td>(</td>
          <td class="paramtype">THD *&#160;</td>
          <td class="paramname"><em>thd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_relay__log__info.html">Relay_log_info</a> *&#160;</td>
          <td class="paramname"><em>rli</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_t_a_b_l_e.html">TABLE</a> *&#160;</td>
          <td class="paramname"><em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_t_a_b_l_e.html">TABLE</a> **&#160;</td>
          <td class="paramname"><em>conv_table_var</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Decide if the table definition is compatible with a table.</p>
<p>Compare the definition with a table to see if it is compatible with it.</p>
<p>A table definition is compatible with a table if:</p><ul>
<li>The columns types of the table definition is a (not necessarily proper) prefix of the column type of the table.</li>
<li>The other way around.</li>
<li>Each column on the master that also exists on the slave can be converted according to the current settings of <code>SLAVE_TYPE_CONVERSIONS</code>.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">thd</td><td></td></tr>
    <tr><td class="paramdir"></td><td class="paramname">rli</td><td>Pointer to relay log info </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">table</td><td>Pointer to table to compare with.</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">tmp_table_var</td><td>Pointer to temporary table for holding conversion table.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">1</td><td>if the table definition is not compatible with <code>table</code> </td></tr>
    <tr><td class="paramname">0</td><td>if the table definition is compatible with <code>table</code> </td></tr>
  </table>
  </dd>
</dl>
<p>Is the definition compatible with a table?</p>
<p>This function will compare the master table with an existing table on the slave and see if they are compatible with respect to the current settings of <code>SLAVE_TYPE_CONVERSIONS</code>.</p>
<p>If the tables are compatible and conversions are required, <code>tmp_table_var</code> will be set to a virtual temporary table with field pointers for the fields that require conversions. This allow simple checking of whether a conversion are to be applied or not.</p>
<p>If tables are compatible, but no conversions are necessary, <code>tmp_table_var</code> will be set to NULL.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">rli_arg[in]</td><td>Relay log info, for error reporting.</td></tr>
    <tr><td class="paramname">table[in]</td><td>Table to compare with</td></tr>
    <tr><td class="paramname">tmp_table_var[out]</td><td>Virtual temporary table for performing conversions, if necessary.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>Master table is compatible with slave table. </td></tr>
    <tr><td class="paramname">false</td><td>Master table is not compatible with slave table. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a07dbe69aabbf2c897317a2c96648a4a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a07dbe69aabbf2c897317a2c96648a4a8">&#9670;&nbsp;</a></span>create_conversion_table()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_t_a_b_l_e.html">TABLE</a> * table_def::create_conversion_table </td>
          <td>(</td>
          <td class="paramtype">THD *&#160;</td>
          <td class="paramname"><em>thd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_relay__log__info.html">Relay_log_info</a> *&#160;</td>
          <td class="paramname"><em>rli</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_t_a_b_l_e.html">TABLE</a> *&#160;</td>
          <td class="paramname"><em>target_table</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create a virtual in-memory temporary table structure.</p>
<p>The table structure has records and field array so that a row can be unpacked into the record for further processing.</p>
<p>In the virtual table, each field that requires conversion will have a non-NULL value, while fields that do not require conversion will have a NULL value.</p>
<p>Some information that is missing in the events, such as the character set for string types, are taken from the table that the field is going to be pushed into, so the target table that the data eventually need to be pushed into need to be supplied.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">thd</td><td>Thread to allocate memory from. </td></tr>
    <tr><td class="paramname">rli</td><td>Relay log info structure, for error reporting. </td></tr>
    <tr><td class="paramname">target_table</td><td>Target table for fields.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A pointer to a temporary table with memory allocated in the thread's memroot, NULL if the table could not be created</dd></dl>
<p>Create a conversion table.</p>
<p>If the function is unable to create the conversion table, an error will be printed and NULL will be returned.</p>
<dl class="section return"><dt>Returns</dt><dd>Pointer to conversion table, or NULL if unable to create conversion table. </dd></dl>

</div>
</div>
<a id="a793dcd937355e094a90d55e2e1bca1c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a793dcd937355e094a90d55e2e1bca1c4">&#9670;&nbsp;</a></span>size()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">ulong table_def::size </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return the number of fields there is type data for.</p>
<dl class="section return"><dt>Returns</dt><dd>The number of fields that there is type data for. </dd></dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>sql/<a class="el" href="rpl__utility_8h_source.html">rpl_utility.h</a></li>
<li>sql/rpl_utility.cc</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
