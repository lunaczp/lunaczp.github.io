<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <!--[if IE ]>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1" />
    <![endif]-->
    <title>MySQL ::   MySQL Internals Manual :: 2.1.7 Additional Suggestions</title>

    
    <link rel="stylesheet" media="screen,projection" href="common/css/mysql.css?v=20140618" />
    <link rel="stylesheet" media="print" href="common/css/print.css?v=20111230" />

            <link rel="stylesheet" href="doc/docs.css" />
        
    
    
    
    <link rel="contents" href="index.html" title="MySQL Manual" /><link rel="start" href="index.html" title="MySQL Manual" /><link rel="prev" href="header-files.html" title="2.1.6 Header Files"/><link rel="next" href="suggested-mode-emacs.html?ff=nopfpls" title="2.1.8 Suggested Mode in emacs"/><link rel="up" href="general-development-guidelines.html" title="2.1 General Development Guidelines"/>        <link rel="shortcut icon" href="common/themes/sakila/favicon.ico" />

    
        
    
    
</head>

<body class="doc" >

<div id="container">

<!--UdmComment-->
<a class="skipToContent" href="#mainContent">Skip navigation links</a>

    <div id="header" >

    <div class="left">

    <div id="logo">
                                            <a href="http://dev.mysql.com/" title="MySQL">
                            <img src="common/logos/logo-mysql-110x57.png" alt="MySQL" width="110" height="57" /></a>
            </div>
            <div id="tagline">The world's most popular open source database</div>

    </div>

    <div class="right">
                <div id="login">
            <p>
                <a class="contact_us" href="http://www.mysql.com/about/contact/">Contact MySQL</a> |
        
                             <a href="https://dev.mysql.com/auth/login/?dest=http%3a%2f%2fdev.mysql.com%2Fdoc%2Finternals%2Fen%2Fadditional-suggestions.html">Login</a> | <a href="https://dev.mysql.com/auth/register/">Register</a>
                        </p>
        </div>

        <div id="search_box"> <!-- Start Search -->
        		<form id="searchform" name="searchform" method="get" action="http://search.oracle.com/search/search">
			<input type="text" id="q" name="q" value="Search" class="swap_value" onfocus="this.value='';" />
			<input type="hidden" id="search_dest" name="group" value="MySQL"/>
			<input type="image" src="common/themes/sakila/search_g.png" id="go" alt="Search" title="Search" />
		    </form>        </div> <!-- End Search -->

    </div>

    </div> 

    <!-- MySQL Navigation -->
    <div id="nav_container">
    
    <div id="flags">
        <ul>
            <li style="position: relative; top: -5px;">
                <!-- Icons from http://icondock.com/free/vector-social-media-icons //-->
                <a href="http://www.facebook.com/mysql"><img class="facebook-icon" src="common/themes/sakila/sp.gif" alt="fb" title="Join us on Facebook" width="20" height="20" /></a>&nbsp;
                <a href="https://plus.google.com/+mysql"><img class="googleplus-icon" src="common/themes/sakila/sp.gif" alt="g+" title="Join Google+ to follow MySQL" width="20" height="20" /></a>&nbsp;
                <a href="https://twitter.com/#!/mysql"><img class="twitter-icon" src="common/themes/sakila/sp.gif" alt="tw" title="Follow us on Twitter" width="20" height="20" /></a>&nbsp;
                <a href="http://www.youtube.com/mysqlchannel"><img class="youtube-icon" src="common/themes/sakila/sp.gif" alt="yt" title="Visit our YouTube channel" width="20" height="20" /></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            </li>
                            
                        </ul>
    </div>

        <div id="nav-tabs">
    <ul>
        <li class="off-left-end"></li>
        <li><a href="http://www.mysql.com">MySQL.com</a></li>
        <li class="off-mid"></li>
        <li><a href="http://www.mysql.com/downloads/">Downloads</a></li>
        <li class="on-left"></li>
        <li class="current"><a href="http://dev.mysql.com/doc/">Documentation</a></li>
        <li class="on-right"></li>
        <li><a href="http://dev.mysql.com">Developer Zone</a></li>
        <li class="off-right-end"></li>
    </ul>
    </div>

        
        <div id="mysql_menu">
            <ul>
	<li class="current"><a class="current " href="/doc/">MySQL Server</a>
	
		
		
	</li>
	
	<li class="link"><a  href="/doc/index-enterprise.html">MySQL Enterprise</a>
	
		
		
	</li>
	
	<li class="link"><a  href="/doc/index-gui.html">Workbench</a>
	
		
		
	</li>
	
	<li class="link"><a  href="/doc/index-utils-fabric.html">Utilities/Fabric</a>
	
		
		
	</li>
	
	<li class="link"><a  href="/doc/index-cluster.html">Cluster</a>
	
		
		
	</li>
	
	<li class="link"><a  href="/doc/index-connectors.html">Connectors</a>
	
		
		
	</li>
	
	<li class="link"><a  href="/doc/index-topic.html">Topic Guides</a>
	
		
		
	</li>
	
	<li class="link"><a  href="/doc/index-expert.html">Expert Guides</a>
	
		
		
	</li>
	
	<li class="link"><a  href="/doc/index-other.html">Other Docs</a>
	
		
		
	</li>
	
	<li class="link"><a  href="/doc/index-archive.html">Archives</a>
	
		
		
	</li>
	
	<li class="link last"><a  href="/doc/index-about.html">About</a>
	
		
		
	</li>
	
</ul>
        </div>

                        <div id="og_sakila">&nbsp;</div>
                    <div id="og_title">&nbsp;</div>
        
    </div>
    <!-- End Navigation Container -->

<!--/UdmComment-->

<div class="page_container">
    <div class="page_sidebar">
	<!--UdmCommentTest-->

	<div id="menu_title"></div>

	<div id="menu">
		<ul>
			<li class="current"><a class="current subitems" href="/doc/index.html">Documentation Library</a>

			<ul class="subitems1">
				 <li><a href="index.html"><b>Table of Contents</b></a>


				 <ul class="subitems2">
				 
				 					 		<li>
					 	<a href="" >MySQL 5.7 Manual</a>  					
				 	</li>

				 
				 					 		<li>
					 	<a href="" >MySQL 5.6 Manual</a>  					
				 	</li>

				 
				 					 		<li>
					 	<a href="" >MySQL 5.5 Manual</a>  					
				 	</li>

				 
				 					 		<li>
					 	<a href="" >MySQL 5.1 Manual</a>  					
				 	</li>

				 
				 					 		<li>
					 	<a href="" >MySQL 5.0 Manual</a>  					
				 	</li>

				 
				 					 		<li>
					 	<a href="" >MySQL 3.23/4.0/4.1 Manual</a>  					
				 	</li>

				 
				 </ul>



				 </li>


			</ul>


			</li>
		</ul>

	 <div class="searchmanual">
			<form action="http://search.oracle.com/search/search" method="get" id="docsearch">
		<strong><label for="searchq">Search manual:</label></strong>
		<br />
		<input id="searchq" type="text" name="q" value="" size="14" />
		<input id="searchsubmit" type="submit" value="Go" />
		<input id="searchgroup" type="hidden" name="group" value="MySQL" />
	</form>	 </div>


	</div>

	
</div>  
<!-- Main content -->

<div id="page" class="sidebar" >

    




	<!--UdmComment-->

<div id="docheader"><a href="index.html"> MySQL Internals Manual</a> :: <a href="coding-guidelines.html">2 Coding Guidelines</a> :: <a href="general-development-guidelines.html">2.1 General Development Guidelines</a> :: 2.1.7 Additional Suggestions</div>

	 
	

	
<script language="javascript">

<!--
function toggle(what){
 if(document.getElementById(what).style.display == "none"){
   document.getElementById(what).style.display = "block";
 }else{
   document.getElementById(what).style.display = "none";
 }
}
//-->

</script>
<noscript></noscript>

<div style="float: right; width: 250px; margin: 0px 0px 8px 8px; background: white">
	<div style="text-align: right; font-size: 90%; margin-bottom: 4px">
		<div style="text-align: left;"><a style="text-decoration: none" href="header-files.html" title="Previous Section">&laquo; 2.1.6 Header Files</a></div>
		<hr size="1" noshade="noshade" align="center" width="40" style="margin: 0px auto 2px auto" />		<a style="text-decoration: none" href="suggested-mode-emacs.html" title="Next Section">2.1.8 Suggested Mode in emacs  &raquo;</a>	</div>
	<div style="padding: 4px 0px 0px 4px; border: 2px dotted #ccc; border-right: none;">
		<b>Section Navigation</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<small>[<a href="#" onclick="toggle('sectionnav');"  onkeypress="if (event.keyCode == 13) { toggle('sectionnav'); }">Toggle</a>]</small>
			<ul id="sectionnav">
				<li class="p"><a href="general-development-guidelines.html">2.1 General Development Guidelines</a></li><li><a href="coding-guidelines-c.html">2.1.1 C/C++ Coding Guidelines of MySQL Server</a></li>
<li><a href="maintaining-coding-guidelines.html">2.1.2 How We Maintain the Server Coding Guidelines</a></li>
<li><a href="indentation-spacing.html">2.1.3 Indentation and Spacing</a></li>
<li><a href="naming-conventions.html">2.1.4 Naming Conventions</a></li>
<li><a href="commenting-code.html">2.1.5 Commenting Code</a></li>
<li><a href="header-files.html">2.1.6 Header Files</a></li>
<li class="self">2.1.7 Additional Suggestions</li>
<li><a href="suggested-mode-emacs.html">2.1.8 Suggested Mode in emacs</a></li>
<li><a href="basic-vim-setup.html">2.1.9 Basic vim Setup</a></li>
<li><a href="alternative-vim-setup.html">2.1.10 Another vim Setup</a></li>
<li><a href="example-setup-ctags.html">2.1.11 Example Setup for ctags</a></li>
</ul>

			</ul>		
	</div>

</div>
<!--/UdmComment-->

<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="additional-suggestions"></a>2.1.7Â Additional Suggestions</h3>

</div>

</div>

</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Try to write code in a lot of black boxes that can be reused
            or at least use a clean, easy to change interface.
          </p></li><li class="listitem"><p>
            Reuse code; There are already many algorithms in MySQL that
            can be reused for list handling, queues, dynamic and hashed
            arrays, sorting, etc.
          </p></li><li class="listitem"><p>
            Use the <code class="literal">my_*</code> functions like
            <code class="literal">my_read()</code>/<code class="literal">my_write()</code>/
            <code class="literal">my_malloc()</code> that you can find in the
            <code class="literal">mysys</code> library, instead of the direct
            system calls; This will make your code easier to debug and
            more portable.
          </p></li><li class="listitem"><p>
            Use <code class="literal">libstring</code> functions (in the
            <code class="literal">strings</code> directory, declared in
            <code class="literal">include/m_string.h</code>) instead of standard
            <code class="literal">libc</code> string functions whenever possible.
          </p></li><li class="listitem"><p>
            Try to always write optimized code, so that you don't have
            to go back and rewrite it a couple of months later. It's
            better to spend 3 times as much time designing and writing
            an optimal function than having to do it all over again
            later on.
          </p></li><li class="listitem"><p>
            Avoid CPU wasteful code, even when its use is trivial, to
            avoid developing sloppy coding habits.
          </p></li><li class="listitem"><p>
            If you can do something in fewer lines, please do so (as
            long as the code will not be slower or much harder to read).
          </p></li><li class="listitem"><p>
            Do not check the same pointer for <code class="literal">NULL</code>
            more than once.
          </p></li><li class="listitem"><p>
            Never use a macro when an (inline) function would work as
            well.
          </p></li><li class="listitem"><p>
            Do not make a function inline if you don't have a very good
            reason for it. In many cases, the extra code that is
            generated is more likely to slow down the resulting code
            than give a speed increase because the bigger code will
            cause more data fetches and instruction misses in the
            processor cache.
</p></li></ul>
</div>
<p>
        It is okay to use inline functions are which satisfy most of the
        following requirements:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  The function is very short (just a few lines).
                </p></li><li class="listitem"><p>
                  The function is used in a speed critical place and is
                  executed over and over again.
                </p></li><li class="listitem"><p>
                  The function is handling the normal case, not some
                  extra functionality that most users will not use.
                </p></li><li class="listitem"><p>
                  The function is rarely called. (This restriction must
                  be followed unless the function translates to fewer
                  than 16 assembler instructions.)
                </p></li><li class="listitem"><p>
                  The compiler can do additional optimizations with
                  inlining and the resulting function will be only a
                  fraction of size of the original one.
</p></li></ul>
</div>
<p>
          </p></li><li class="listitem"><p>
            Think assembly - make it easier for the compiler to optimize
            your code.
          </p></li><li class="listitem"><p>
            Avoid using <code class="literal">malloc()</code>, which is very slow.
            For memory allocations that only need to live for the
            lifetime of one thread, use <code class="literal">sql_alloc()</code>
            instead.
          </p></li><li class="listitem"><p>
            All functions that can report an error (usually an
            allocation error), should return
            <code class="literal">0/FALSE/false</code> on success,
            <code class="literal">1/TRUE/true</code> on failure. Other return
            values should go in an output argument. If you have a
            predicate function which returns <code class="literal">bool</code>,
            and cannot fail, document that fact clearly (in the header
            file). Recommendation when writing new code: use return type
            int, to distinguish from predicate functions. Returning
            <code class="literal">true</code> on error, allows us to write:
</p></li></ul>
</div>
<pre class="programlisting">
if (a() || b() || c())
  error("something went wrong");
</pre><p>
        However, short-circuit evaluation like that above is not the
        best method for evaluating options.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Beware of truncation when returning
            <code class="literal">TRUE/true</code> to indicate an error:
</p></li></ul>
</div>
<pre class="programlisting">
my_bool foo(int val)      { return val; } /* Bad. */
int     foo(longlong val) { return val; } /* Bad. */
</pre><pre class="programlisting">
my_bool foo(int val)      { return test(val); } /* Good. */
int     foo(longlong val) { return test(val); } /* Good. */
</pre>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Using <code class="literal">goto</code> is okay if not abused.
          </p></li><li class="listitem"><p>
            If you have an 'if' statement that ends with a 'goto' or
            'return' you should NOT have an else statement:
</p></li></ul>
</div>
<pre class="programlisting">
if (a == b)
  return 5;
else return 6;

-&gt;

if (a == b)
  return 5;
return 6;
</pre>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Avoid default variable initializations. Use
            <code class="literal">LINT_INIT()</code> if the compiler complains
            after making sure that there is really no way the variable
            can be used uninitialized.
          </p></li><li class="listitem"><p>
            In C code, use <code class="literal">TRUE</code> and
            <code class="literal">FALSE</code> rather than <code class="literal">1/0</code>
          </p></li><li class="listitem"><p>
            In C++ code, it is OK to use <code class="literal">true</code> and
            <code class="literal">false</code> (do not use
            <code class="literal">1/0</code>). You can use C++
            <code class="literal">bool/true/false</code> when calling C functions
            (values will be safely promoted to my_bool).
          </p></li><li class="listitem"><p>
            <code class="literal">bool</code> exists only in C++. In C, you have
            to use <code class="literal">my_bool</code> (which is
            <code class="literal">char</code>); it has different cast rules than
            <code class="literal">bool</code>:
</p></li></ul>
</div>
<pre class="programlisting">
int c= 256*2;
bool a= c;          /* a gets 'true' */
my_bool b= c;       /* b gets zero, that is, 'false': BAD */
my_bool b= test(c); /* b gets 'true': GOOD */
</pre>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Do not instantiate a class if you do not have to.
          </p></li><li class="listitem"><p>
            Use pointers rather than array indexing when operating on
            strings.
          </p></li><li class="listitem"><p>
            Never pass parameters with the
            <code class="literal">&amp;variable_name</code> construct in C++.
            Always use a pointer instead!
</p></li></ul>
</div>
<p>
        The reason is that the above makes it much harder for the one
        reading the caller function code to know what is happening and
        what kind of code the compiler is generating for the call.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Do not use the <code class="literal">%p</code> marker of
            <code class="literal">printf()</code> (<code class="literal">fprintf()</code>,
            <code class="literal">vprintf()</code>, etc) because it leads to
            different outputs (for example on some Linux and Mac OS X
            the output starts with <code class="literal">0x</code> while it does
            not on some Solaris). In MySQL 5.5 and later, use
            <code class="literal">my_vsnprint</code>,
            <code class="literal">DBUG_PRINT</code> withÂ %p for pointer
            formatting consistent across different platforms. In earlier
            versions, use printf-family functions with
            <code class="literal">0x%lx</code>, but beware it truncates pointers
            on 64-bit Windows. Being sure that there is always
            <code class="literal">0x</code> enables us to quickly identify pointer
            values in the DBUG trace.
          </p></li><li class="listitem"><p>
            Relying on loop counter variables being local to the loop
            body if declared in the <code class="literal">for</code> statement is
            not portable. Some compilers still don't implement this ANSI
            C++ specification. The symptom of such use is an error like
            this:
</p></li></ul>
</div>
<pre class="programlisting">
c-1101 CC: ERROR File = listener.cc, Line = 187
  "i" has already been declared in the current scope.

    for (int i= 0; i &lt; num_sockets; i++)
</pre>
</div>
<div class="copyright-footer">

</div>
<!--UdmComment--><div id="docnav"><a rel="prev" href="header-files.html" title="2.1.6 Header Files">Previous</a> / <a rel="next" href="suggested-mode-emacs.html" title="2.1.8 Suggested Mode in emacs">Next</a> / <a rel="up" href="general-development-guidelines.html" title="2.1 General Development Guidelines">Up</a> / <a rel="contents" href="index.html">Table of Contents</a></div><!--/UdmComment--><br class="clear" /><!--UdmComment--><div id="comments"><h1>User Comments</h1><p><form method="POST" action="/doc/mysql/comment.php">
          <input type="hidden" name="sect" value="additional-suggestions" />
          <input type="hidden" name="return" value="/doc/internals/en/additional-suggestions.html" />
          <input type="submit" value="Add your own comment" />
          </form></p></div><!--UdmComment--><div id="docnav"><a href="#">Top</a> / <a rel="prev" href="header-files.html" title="2.1.6 Header Files">Previous</a> / <a rel="next" href="suggested-mode-emacs.html" title="2.1.8 Suggested Mode in emacs">Next</a> / <a rel="up" href="general-development-guidelines.html" title="2.1 General Development Guidelines">Up</a> / <a rel="contents" href="index.html">Table of Contents</a></div><!--/UdmComment--></div></div>





</div> <!--End Container -->




 </div> 
</div> 
<div id="footer">
    <div class="five-col">
        <div class="links">
            <ul>
                <li class="top"><a href="http://dev.mysql.com">Developer Zone</a></li>
                <li><a href="http://dev.mysql.com/articles/">Developer Articles</a></li>
                <li><a href="http://forums.mysql.com/">Forums</a></li>
                <li><a href="http://bugs.mysql.com/">Bugs</a></li>
                <li><a href="http://dev.mysql.com/worklog/">Worklog</a></li>
                                <li><a href="http://planet.mysql.com/">Planet MySQL</a></li>
                            </ul>
        </div>
    
        <div class="links">
            <ul>
                <li class="top"><a href="http://dev.mysql.com/downloads/">Downloads</a></li>
                <li><a href="http://dev.mysql.com/downloads/mysql/">MySQL Community Server</a></li>
                <li><a href="http://dev.mysql.com/downloads/cluster/">MySQL Cluster</a></li>
                <li><a href="http://dev.mysql.com/downloads/fabric/">MySQL Fabric</a></li>
                <li><a href="http://dev.mysql.com/downloads/utilities/">MySQL Utilities</a></li>
                <li><a href="http://dev.mysql.com/downloads/workbench/">MySQL Workbench</a></li>
            </ul>
        </div>


        <div class="links">
            <ul>
                <li class="top"><a href="http://dev.mysql.com/doc/">Documentation</a></li>
                <li><a href="http://dev.mysql.com/doc/">MySQL Reference Manuals</a></li>
                <li><a href="http://dev.mysql.com/doc/index-gui.html">MySQL Workbench</a></li>
                <li><a href="http://dev.mysql.com/doc/index-expert.html">Expert Guides</a></li>
                <li><a href="http://dev.mysql.com/doc/index-topic.html">Topic Guides</a></li>
                <li><a href="http://dev.mysql.com/doc/index-cluster.html">MySQL Cluster</a></li>
            </ul>
        </div>


        <div class="links">
            <ul>
                <li class="top"><a href="http://www.mysql.com/about/">About MySQL</a></li>
                <li><a href="http://www.mysql.com/about/contact/">Contact Us</a></li>
                                 <li><a href="http://www.mysql.com/buy-mysql/">How to Buy</a></li>
                <li><a href="http://www.mysql.com/partners/">Partners</a></li>
                <li><a href="http://www.mysql.com/about/jobs/">Job Opportunities</a></li>
                <li><a href="http://www.mysql.com/sitemap.html">Site Map</a></li>
            </ul>
        </div>
    
        <div class="links">
            <ul>
                <li class="top"><a href="http://www.mysql.com/about/legal/">Legal</a></li>
                <li><a href="http://www.mysql.com/about/legal/">Legal Policies</a></li>
                <li><a href="http://www.oracle.com/us/legal/privacy/index.htm">Your Privacy Rights</a></li>
                <li><a href="http://www.oracle.com/us/legal/terms/index.html">Terms of Use</a></li>
                <li><a href="http://www.oracle.com/us/legal/third-party-trademarks/index.html">Trademark Policy</a></li>
                <li><a href="http://www.oracle.com/technetwork/community/oca-486395.html">Contributor Agreement</a></li>
            </ul>
        </div>
    
                <div id="search" class="en">
                <form id="footer_search" action="http://search.oracle.com/search/search" method="get">
            <input type="text" id="f_q" name="q" value="" class="swap_value" />
	    <input type="hidden"  name="group" value="MySQL"/>
	    <input type="image" src="common/themes/sakila/footer_search_g.png" id="f_go" alt="Search" title="Search" />
        </form>        </div>
            
    </div>
</div><!-- End Footer -->

<div id="copyright-oracle"><a href="http://www.oracle.com/"><img src="common/logos/logo-oracle-red-91x22.gif" alt="Oracle" width="91" height="22" /></a>&nbsp;&nbsp;<span>&copy; 2015, Oracle Corporation and/or its affiliates</span></div>


<script src="common/js/metrics/s_code_remote.js"></script>

</body>
</html>