<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PERFORMANCE SCHEMA: Locking</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PERFORMANCE SCHEMA
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">Locking</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga65cffe586bef8fdfb5334d343c069df6"><td class="memItemLeft" align="right" valign="top"><a id="ga65cffe586bef8fdfb5334d343c069df6"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>GET_LOCK_UNLOCK</b>&#160;&#160;&#160;1</td></tr>
<tr class="separator:ga65cffe586bef8fdfb5334d343c069df6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1bef164e121fc9d85a6e19eae9625365"><td class="memItemLeft" align="right" valign="top"><a id="ga1bef164e121fc9d85a6e19eae9625365"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>GET_LOCK_STORE_LOCKS</b>&#160;&#160;&#160;2</td></tr>
<tr class="separator:ga1bef164e121fc9d85a6e19eae9625365"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga9633a7f4dda9f6c4c741e43df84e24f3"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structst__mysql__lock.html">MYSQL_LOCK</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___locking.html#ga9633a7f4dda9f6c4c741e43df84e24f3">get_lock_data</a> (THD *<a class="el" href="row0quiesce_8cc.html#a75b6f5ba5a17ae9fb524f56a5eed51cb">thd</a>, <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> **table_ptr, uint count, uint <a class="el" href="handler0alter_8cc.html#a4069e5feb5d17fbac4d832518d169cdd">flags</a>)</td></tr>
<tr class="separator:ga9633a7f4dda9f6c4c741e43df84e24f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadeee13e85dfc0f473985f24f862c633f"><td class="memItemLeft" align="right" valign="top"><a id="gadeee13e85dfc0f473985f24f862c633f"></a>
static int&#160;</td><td class="memItemRight" valign="bottom"><b>lock_external</b> (THD *<a class="el" href="row0quiesce_8cc.html#a75b6f5ba5a17ae9fb524f56a5eed51cb">thd</a>, <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> **<a class="el" href="row0upd_8cc.html#ab172ed3d3d31ff02fc5f798fe7e1bfb8">table</a>, uint count)</td></tr>
<tr class="separator:gadeee13e85dfc0f473985f24f862c633f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2022104b54fa744b1e6276b24c76eb74"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___locking.html#ga2022104b54fa744b1e6276b24c76eb74">unlock_external</a> (THD *<a class="el" href="row0quiesce_8cc.html#a75b6f5ba5a17ae9fb524f56a5eed51cb">thd</a>, <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> **<a class="el" href="row0upd_8cc.html#ab172ed3d3d31ff02fc5f798fe7e1bfb8">table</a>, uint count)</td></tr>
<tr class="separator:ga2022104b54fa744b1e6276b24c76eb74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa6d04e38cbcf6f9f05f18134f7abfc81"><td class="memItemLeft" align="right" valign="top"><a id="gaa6d04e38cbcf6f9f05f18134f7abfc81"></a>
static void&#160;</td><td class="memItemRight" valign="bottom"><b>print_lock_error</b> (int <a class="el" href="row0merge_8cc.html#a35322fe0b818842195cfd235eec09293">error</a>, const char *)</td></tr>
<tr class="separator:gaa6d04e38cbcf6f9f05f18134f7abfc81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga64e60435751e25ded112238f216bfd0c"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___locking.html#ga64e60435751e25ded112238f216bfd0c">lock_tables_check</a> (THD *<a class="el" href="row0quiesce_8cc.html#a75b6f5ba5a17ae9fb524f56a5eed51cb">thd</a>, <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> **<a class="el" href="fts0fts_8cc.html#aa86c147940343159f5b38505b80bb233">tables</a>, uint count, uint <a class="el" href="handler0alter_8cc.html#a4069e5feb5d17fbac4d832518d169cdd">flags</a>)</td></tr>
<tr class="separator:ga64e60435751e25ded112238f216bfd0c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3cdefe9db62025f107be509007ba15d1"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___locking.html#ga3cdefe9db62025f107be509007ba15d1">reset_lock_data</a> (<a class="el" href="structst__mysql__lock.html">MYSQL_LOCK</a> *sql_lock)</td></tr>
<tr class="separator:ga3cdefe9db62025f107be509007ba15d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9085310cb26b5f8574f517a7373f4740"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___locking.html#ga9085310cb26b5f8574f517a7373f4740">reset_lock_data_and_free</a> (<a class="el" href="structst__mysql__lock.html">MYSQL_LOCK</a> **mysql_lock)</td></tr>
<tr class="separator:ga9085310cb26b5f8574f517a7373f4740"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3a5f18c7a05b36a6e93c1d8e33cece78"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structst__mysql__lock.html">MYSQL_LOCK</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___locking.html#ga3a5f18c7a05b36a6e93c1d8e33cece78">mysql_lock_tables</a> (THD *<a class="el" href="row0quiesce_8cc.html#a75b6f5ba5a17ae9fb524f56a5eed51cb">thd</a>, <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> **<a class="el" href="fts0fts_8cc.html#aa86c147940343159f5b38505b80bb233">tables</a>, uint count, uint <a class="el" href="handler0alter_8cc.html#a4069e5feb5d17fbac4d832518d169cdd">flags</a>)</td></tr>
<tr class="separator:ga3a5f18c7a05b36a6e93c1d8e33cece78"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2bff80304c9d27f634976ac8fe60cd38"><td class="memItemLeft" align="right" valign="top"><a id="ga2bff80304c9d27f634976ac8fe60cd38"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>mysql_unlock_tables</b> (THD *<a class="el" href="row0quiesce_8cc.html#a75b6f5ba5a17ae9fb524f56a5eed51cb">thd</a>, <a class="el" href="structst__mysql__lock.html">MYSQL_LOCK</a> *sql_lock)</td></tr>
<tr class="separator:ga2bff80304c9d27f634976ac8fe60cd38"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafad092ec9a399db99abd75b57a9ee679"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___locking.html#gafad092ec9a399db99abd75b57a9ee679">mysql_unlock_some_tables</a> (THD *<a class="el" href="row0quiesce_8cc.html#a75b6f5ba5a17ae9fb524f56a5eed51cb">thd</a>, <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> **<a class="el" href="row0upd_8cc.html#ab172ed3d3d31ff02fc5f798fe7e1bfb8">table</a>, uint count)</td></tr>
<tr class="separator:gafad092ec9a399db99abd75b57a9ee679"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1e24a131cbe030c49d953669f804877d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___locking.html#ga1e24a131cbe030c49d953669f804877d">mysql_unlock_read_tables</a> (THD *<a class="el" href="row0quiesce_8cc.html#a75b6f5ba5a17ae9fb524f56a5eed51cb">thd</a>, <a class="el" href="structst__mysql__lock.html">MYSQL_LOCK</a> *sql_lock)</td></tr>
<tr class="separator:ga1e24a131cbe030c49d953669f804877d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad40fe56766e1b54e2fed60814aec1e58"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___locking.html#gad40fe56766e1b54e2fed60814aec1e58">mysql_lock_remove</a> (THD *<a class="el" href="row0quiesce_8cc.html#a75b6f5ba5a17ae9fb524f56a5eed51cb">thd</a>, <a class="el" href="structst__mysql__lock.html">MYSQL_LOCK</a> *locked, <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> *<a class="el" href="row0upd_8cc.html#ab172ed3d3d31ff02fc5f798fe7e1bfb8">table</a>)</td></tr>
<tr class="separator:gad40fe56766e1b54e2fed60814aec1e58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga07896e99c9c248c6441be5c13c484303"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___locking.html#ga07896e99c9c248c6441be5c13c484303">mysql_lock_abort</a> (THD *<a class="el" href="row0quiesce_8cc.html#a75b6f5ba5a17ae9fb524f56a5eed51cb">thd</a>, <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> *<a class="el" href="row0upd_8cc.html#ab172ed3d3d31ff02fc5f798fe7e1bfb8">table</a>, bool upgrade_lock)</td></tr>
<tr class="separator:ga07896e99c9c248c6441be5c13c484303"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga321511c56502643e5aecbe6ed3e43b58"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___locking.html#ga321511c56502643e5aecbe6ed3e43b58">mysql_lock_abort_for_thread</a> (THD *<a class="el" href="row0quiesce_8cc.html#a75b6f5ba5a17ae9fb524f56a5eed51cb">thd</a>, <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> *<a class="el" href="row0upd_8cc.html#ab172ed3d3d31ff02fc5f798fe7e1bfb8">table</a>)</td></tr>
<tr class="separator:ga321511c56502643e5aecbe6ed3e43b58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae8e0ecd1f7872040079f5319aacd93a2"><td class="memItemLeft" align="right" valign="top"><a id="gae8e0ecd1f7872040079f5319aacd93a2"></a>
<a class="el" href="structst__mysql__lock.html">MYSQL_LOCK</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>mysql_lock_merge</b> (<a class="el" href="structst__mysql__lock.html">MYSQL_LOCK</a> *<a class="el" href="row0merge_8cc.html#aaba8987b345486af51614561bddd051b">a</a>, <a class="el" href="structst__mysql__lock.html">MYSQL_LOCK</a> *<a class="el" href="row0merge_8cc.html#a40730b4776204efc5a07b947ce63f0b4">b</a>)</td></tr>
<tr class="separator:gae8e0ecd1f7872040079f5319aacd93a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac67865dd0ef1b003fdee2182aba9a049"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___locking.html#gac67865dd0ef1b003fdee2182aba9a049">lock_schema_name</a> (THD *<a class="el" href="row0quiesce_8cc.html#a75b6f5ba5a17ae9fb524f56a5eed51cb">thd</a>, const char *db)</td></tr>
<tr class="separator:gac67865dd0ef1b003fdee2182aba9a049"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab03d9cc9ff9682e9f2a961685fd90cb3"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___locking.html#gab03d9cc9ff9682e9f2a961685fd90cb3">lock_object_name</a> (THD *<a class="el" href="row0quiesce_8cc.html#a75b6f5ba5a17ae9fb524f56a5eed51cb">thd</a>, <a class="el" href="class_m_d_l__key.html#a391ec4bd98fec6852a48f7856546ed3b">MDL_key::enum_mdl_namespace</a> mdl_type, const char *db, const char *<a class="el" href="srv0start_8cc.html#a03c6040f5fe625af9dc4a701925fbe65">name</a>)</td></tr>
<tr class="separator:gab03d9cc9ff9682e9f2a961685fd90cb3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:gadb186a1125c10d63d0217bc321a4c95a"><td class="memItemLeft" align="right" valign="top"><a id="gadb186a1125c10d63d0217bc321a4c95a"></a>
<a class="el" href="structst__hash.html">HASH</a>&#160;</td><td class="memItemRight" valign="bottom"><b>open_cache</b></td></tr>
<tr class="separator:gadb186a1125c10d63d0217bc321a4c95a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9ec7eb7dbcce8449c3a6df36c3945b08"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><b>thr_lock_errno_to_mysql</b> []</td></tr>
<tr class="separator:ga9ec7eb7dbcce8449c3a6df36c3945b08"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga9633a7f4dda9f6c4c741e43df84e24f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga9633a7f4dda9f6c4c741e43df84e24f3">&#9670;&nbsp;</a></span>get_lock_data()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="structst__mysql__lock.html">MYSQL_LOCK</a> * get_lock_data </td>
          <td>(</td>
          <td class="paramtype">THD *&#160;</td>
          <td class="paramname"><em>thd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_t_a_b_l_e.html">TABLE</a> **&#160;</td>
          <td class="paramname"><em>table_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint&#160;</td>
          <td class="paramname"><em>count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get lock structures from table structs and initialize locks.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">thd</td><td>Thread handler </td></tr>
    <tr><td class="paramname">table_ptr</td><td>Pointer to tables that should be locks </td></tr>
    <tr><td class="paramname">flags</td><td>One of:<ul>
<li>GET_LOCK_UNLOCK : If we should send TL_IGNORE to store lock</li>
<li>GET_LOCK_STORE_LOCKS : Store lock info in <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> </li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="gab03d9cc9ff9682e9f2a961685fd90cb3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab03d9cc9ff9682e9f2a961685fd90cb3">&#9670;&nbsp;</a></span>lock_object_name()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool lock_object_name </td>
          <td>(</td>
          <td class="paramtype">THD *&#160;</td>
          <td class="paramname"><em>thd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_m_d_l__key.html#a391ec4bd98fec6852a48f7856546ed3b">MDL_key::enum_mdl_namespace</a>&#160;</td>
          <td class="paramname"><em>mdl_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Obtain an exclusive metadata lock on an object name.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">thd</td><td>Thread handle. </td></tr>
    <tr><td class="paramname">mdl_type</td><td>Object type (currently functions, procedures and events can be name-locked). </td></tr>
    <tr><td class="paramname">db</td><td>The schema the object belongs to. </td></tr>
    <tr><td class="paramname">name</td><td>Object name in the schema.</td></tr>
  </table>
  </dd>
</dl>
<p>This function assumes that no metadata locks were acquired before calling it. Additionally, it cannot be called while holding LOCK_open mutex. Both these invariants are enforced by asserts in <a class="el" href="class_m_d_l__context.html#a4583e611d097158c5f08b8d1133fbd7e">MDL_context::acquire_locks()</a>. To avoid deadlocks, we do not try to obtain exclusive metadata locks in LOCK TABLES mode, since in this mode there may be other metadata locks already taken by the current connection, and we must not wait for MDL locks while holding locks.</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">FALSE</td><td>Success. </td></tr>
    <tr><td class="paramname">TRUE</td><td>Failure: we're in LOCK TABLES mode, or out of memory, or this connection was killed. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="gac67865dd0ef1b003fdee2182aba9a049"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac67865dd0ef1b003fdee2182aba9a049">&#9670;&nbsp;</a></span>lock_schema_name()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool lock_schema_name </td>
          <td>(</td>
          <td class="paramtype">THD *&#160;</td>
          <td class="paramname"><em>thd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>db</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Obtain an exclusive metadata lock on a schema name.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">thd</td><td>Thread handle. </td></tr>
    <tr><td class="paramname">db</td><td>The database name.</td></tr>
  </table>
  </dd>
</dl>
<p>This function cannot be called while holding LOCK_open mutex. To avoid deadlocks, we do not try to obtain exclusive metadata locks in LOCK TABLES mode, since in this mode there may be other metadata locks already taken by the current connection, and we must not wait for MDL locks while holding locks.</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">FALSE</td><td>Success. </td></tr>
    <tr><td class="paramname">TRUE</td><td>Failure: we're in LOCK TABLES mode, or out of memory, or this connection was killed. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga64e60435751e25ded112238f216bfd0c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga64e60435751e25ded112238f216bfd0c">&#9670;&nbsp;</a></span>lock_tables_check()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int lock_tables_check </td>
          <td>(</td>
          <td class="paramtype">THD *&#160;</td>
          <td class="paramname"><em>thd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_t_a_b_l_e.html">TABLE</a> **&#160;</td>
          <td class="paramname"><em>tables</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint&#160;</td>
          <td class="paramname"><em>count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Perform semantic checks for mysql_lock_tables. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">thd</td><td>The current thread </td></tr>
    <tr><td class="paramname">tables</td><td>The tables to lock </td></tr>
    <tr><td class="paramname">count</td><td>The number of tables to lock </td></tr>
    <tr><td class="paramname">flags</td><td>Lock flags </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if all the check passed, non zero if a check failed. </dd></dl>

</div>
</div>
<a id="ga07896e99c9c248c6441be5c13c484303"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga07896e99c9c248c6441be5c13c484303">&#9670;&nbsp;</a></span>mysql_lock_abort()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mysql_lock_abort </td>
          <td>(</td>
          <td class="paramtype">THD *&#160;</td>
          <td class="paramname"><em>thd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_t_a_b_l_e.html">TABLE</a> *&#160;</td>
          <td class="paramname"><em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>upgrade_lock</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Abort all other threads waiting to get lock in table. </p>

</div>
</div>
<a id="ga321511c56502643e5aecbe6ed3e43b58"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga321511c56502643e5aecbe6ed3e43b58">&#9670;&nbsp;</a></span>mysql_lock_abort_for_thread()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool mysql_lock_abort_for_thread </td>
          <td>(</td>
          <td class="paramtype">THD *&#160;</td>
          <td class="paramname"><em>thd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_t_a_b_l_e.html">TABLE</a> *&#160;</td>
          <td class="paramname"><em>table</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Abort one thread / table combination.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">thd</td><td>Thread handler </td></tr>
    <tr><td class="paramname">table</td><td>Table that should be removed from lock queue</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Table was not locked by another thread </td></tr>
    <tr><td class="paramname">1</td><td>Table was locked by at least one other thread </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="gad40fe56766e1b54e2fed60814aec1e58"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad40fe56766e1b54e2fed60814aec1e58">&#9670;&nbsp;</a></span>mysql_lock_remove()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mysql_lock_remove </td>
          <td>(</td>
          <td class="paramtype">THD *&#160;</td>
          <td class="paramname"><em>thd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structst__mysql__lock.html">MYSQL_LOCK</a> *&#160;</td>
          <td class="paramname"><em>locked</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_t_a_b_l_e.html">TABLE</a> *&#160;</td>
          <td class="paramname"><em>table</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Try to find the table in the list of locked tables. In case of success, unlock the table and remove it from this list. If a table has more than one lock instance, removes them all.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">thd</td><td>thread context </td></tr>
    <tr><td class="paramname">locked</td><td>list of locked tables </td></tr>
    <tr><td class="paramname">table</td><td>the table to unlock </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga3a5f18c7a05b36a6e93c1d8e33cece78"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga3a5f18c7a05b36a6e93c1d8e33cece78">&#9670;&nbsp;</a></span>mysql_lock_tables()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structst__mysql__lock.html">MYSQL_LOCK</a>* mysql_lock_tables </td>
          <td>(</td>
          <td class="paramtype">THD *&#160;</td>
          <td class="paramname"><em>thd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_t_a_b_l_e.html">TABLE</a> **&#160;</td>
          <td class="paramname"><em>tables</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint&#160;</td>
          <td class="paramname"><em>count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Lock tables.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">thd</td><td>The current thread. </td></tr>
    <tr><td class="paramname">tables</td><td>An array of pointers to the tables to lock. </td></tr>
    <tr><td class="paramname">count</td><td>The number of tables to lock. </td></tr>
    <tr><td class="paramname">flags</td><td>Options: MYSQL_LOCK_IGNORE_GLOBAL_READ_ONLY Ignore SET GLOBAL READ_ONLY MYSQL_LOCK_IGNORE_TIMEOUT Use maximum timeout value.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">A</td><td>lock structure pointer on success. </td></tr>
    <tr><td class="paramname">NULL</td><td>if an error or if wait on a lock was killed. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga1e24a131cbe030c49d953669f804877d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga1e24a131cbe030c49d953669f804877d">&#9670;&nbsp;</a></span>mysql_unlock_read_tables()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mysql_unlock_read_tables </td>
          <td>(</td>
          <td class="paramtype">THD *&#160;</td>
          <td class="paramname"><em>thd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structst__mysql__lock.html">MYSQL_LOCK</a> *&#160;</td>
          <td class="paramname"><em>sql_lock</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>unlock all tables locked for read. </p>

</div>
</div>
<a id="gafad092ec9a399db99abd75b57a9ee679"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gafad092ec9a399db99abd75b57a9ee679">&#9670;&nbsp;</a></span>mysql_unlock_some_tables()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mysql_unlock_some_tables </td>
          <td>(</td>
          <td class="paramtype">THD *&#160;</td>
          <td class="paramname"><em>thd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_t_a_b_l_e.html">TABLE</a> **&#160;</td>
          <td class="paramname"><em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint&#160;</td>
          <td class="paramname"><em>count</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Unlock some of the tables locked by mysql_lock_tables.</p>
<p>This will work even if get_lock_data fails (next unlock will free all) </p>

</div>
</div>
<a id="ga3cdefe9db62025f107be509007ba15d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga3cdefe9db62025f107be509007ba15d1">&#9670;&nbsp;</a></span>reset_lock_data()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void reset_lock_data </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structst__mysql__lock.html">MYSQL_LOCK</a> *&#160;</td>
          <td class="paramname"><em>sql_lock</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Reset lock type in lock data</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mysql_lock</td><td>Lock structures to reset.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>After a locking error we want to quit the locking of the table(s). The test case in the bug report for Bug #18544 has the following cases: 1. Locking error in lock_external() due to InnoDB timeout.<ol type="1">
<li>Locking error in <a class="el" href="group___locking.html#ga9633a7f4dda9f6c4c741e43df84e24f3">get_lock_data()</a> due to missing write permission.</li>
<li>Locking error in wait_if_global_read_lock() due to lock conflict.</li>
</ol>
</dd>
<dd>
In all these cases we have already set the lock type into the lock data of the open table(s). If the table(s) are in the open table cache, they could be reused with the non-zero lock type set. This could lead to ignoring a different lock type with the next lock.</dd>
<dd>
Clear the lock type of all lock data. This ensures that the next lock request will set its lock type properly. </dd></dl>

</div>
</div>
<a id="ga9085310cb26b5f8574f517a7373f4740"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga9085310cb26b5f8574f517a7373f4740">&#9670;&nbsp;</a></span>reset_lock_data_and_free()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void reset_lock_data_and_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structst__mysql__lock.html">MYSQL_LOCK</a> **&#160;</td>
          <td class="paramname"><em>mysql_lock</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Reset lock type in lock data and free.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mysql_lock</td><td>Lock structures to reset. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga2022104b54fa744b1e6276b24c76eb74"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga2022104b54fa744b1e6276b24c76eb74">&#9670;&nbsp;</a></span>unlock_external()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int unlock_external </td>
          <td>(</td>
          <td class="paramtype">THD *&#160;</td>
          <td class="paramname"><em>thd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_t_a_b_l_e.html">TABLE</a> **&#160;</td>
          <td class="paramname"><em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint&#160;</td>
          <td class="paramname"><em>count</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Unlock a set of external. </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ga9ec7eb7dbcce8449c3a6df36c3945b08"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga9ec7eb7dbcce8449c3a6df36c3945b08">&#9670;&nbsp;</a></span>thr_lock_errno_to_mysql</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int thr_lock_errno_to_mysql[]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">=</div><div class="line">{ 0, ER_LOCK_ABORTED, ER_LOCK_WAIT_TIMEOUT, ER_LOCK_DEADLOCK }</div></div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
