<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PERFORMANCE SCHEMA: Storage Engine API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PERFORMANCE SCHEMA
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a>  </div>
  <div class="headertitle">
<div class="title">Storage Engine API</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structitem__observer__cb__data.html">item_observer_cb_data</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structserver__handle__v1__t.html">server_handle_v1_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfeature__info.html">feature_info</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structengine__info.html">engine_info</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structengine__interface__v1.html">engine_interface_v1</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga502bebaa798b3401940137a7a16d8fe5"><td class="memItemLeft" align="right" valign="top"><a id="ga502bebaa798b3401940137a7a16d8fe5"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ENGINE_INTERFACE_VERSION</b>&#160;&#160;&#160;1</td></tr>
<tr class="separator:ga502bebaa798b3401940137a7a16d8fe5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:gacd0112eec954e1e92962bc0d8aff5d96"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___engine.html#gacd0112eec954e1e92962bc0d8aff5d96">ADD_STAT</a>) (const char *key, const uint16_t klen, const char *val, const uint32_t vlen, const void *cookie)</td></tr>
<tr class="separator:gacd0112eec954e1e92962bc0d8aff5d96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8bb79ab44dc192cae02c9d50f89bc6e2"><td class="memItemLeft" align="right" valign="top">typedef bool(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___engine.html#ga8bb79ab44dc192cae02c9d50f89bc6e2">ADD_RESPONSE</a>) (const void *key, uint16_t keylen, const void *ext, uint8_t extlen, const void *body, uint32_t bodylen, uint8_t datatype, uint16_t <a class="el" href="rem0rec_8cc.html#ad891b6122c6331f9c438fda0302a8d5e">status</a>, uint64_t cas, const void *cookie)</td></tr>
<tr class="separator:ga8bb79ab44dc192cae02c9d50f89bc6e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga18337f714e9a050bc1bc9ba42d1ae42d"><td class="memItemLeft" align="right" valign="top">typedef tap_event_t(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___engine.html#ga18337f714e9a050bc1bc9ba42d1ae42d">TAP_ITERATOR</a>) (<a class="el" href="structengine__interface.html">ENGINE_HANDLE</a> *handle, const void *cookie, item **item, void **engine_specific, uint16_t *nengine_specific, uint8_t *ttl, uint16_t *<a class="el" href="handler0alter_8cc.html#a4069e5feb5d17fbac4d832518d169cdd">flags</a>, uint32_t *seqno, uint16_t *vbucket)</td></tr>
<tr class="separator:ga18337f714e9a050bc1bc9ba42d1ae42d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2cd1e92379a39a802320bd728201d0ca"><td class="memItemLeft" align="right" valign="top">typedef ENGINE_ERROR_CODE(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___engine.html#ga2cd1e92379a39a802320bd728201d0ca">CREATE_INSTANCE</a>) (uint64_t interface, GET_SERVER_API get_server_api, <a class="el" href="structengine__interface.html">ENGINE_HANDLE</a> **handle)</td></tr>
<tr class="separator:ga2cd1e92379a39a802320bd728201d0ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga31b9874f683847a88a7318fbe1556ca2"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structengine__interface__v1.html">engine_interface_v1</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___engine.html#ga31b9874f683847a88a7318fbe1556ca2">ENGINE_HANDLE_V1</a></td></tr>
<tr class="separator:ga31b9874f683847a88a7318fbe1556ca2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:gada8998ba8969f0f762a86cccb64f7ed4"><td class="memItemLeft" align="right" valign="top"><a id="gada8998ba8969f0f762a86cccb64f7ed4"></a>enum &#160;</td><td class="memItemRight" valign="bottom"><b>tap_event_t</b> { <br />
&#160;&#160;<b>TAP_MUTATION</b> = 1, 
<b>TAP_DELETION</b>, 
<b>TAP_FLUSH</b>, 
<b>TAP_OPAQUE</b>, 
<br />
&#160;&#160;<b>TAP_VBUCKET_SET</b>, 
<b>TAP_ACK</b>, 
<b>TAP_DISCONNECT</b>, 
<b>TAP_NOOP</b>, 
<br />
&#160;&#160;<b>TAP_PAUSE</b>, 
<b>TAP_CHECKPOINT_START</b>, 
<b>TAP_CHECKPOINT_END</b>
<br />
 }</td></tr>
<tr class="separator:gada8998ba8969f0f762a86cccb64f7ed4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga39cb91cd4d7e1de23713688ab4c575e0"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___engine.html#ga39cb91cd4d7e1de23713688ab4c575e0">engine_feature_t</a> { <br />
&#160;&#160;<a class="el" href="group___engine.html#gga39cb91cd4d7e1de23713688ab4c575e0a2d032e66b79aa1f5a06fea36dc2ed844">ENGINE_FEATURE_CAS</a>, 
<a class="el" href="group___engine.html#gga39cb91cd4d7e1de23713688ab4c575e0a1770c64b0aa502a874b044df9a2a1e6e">ENGINE_FEATURE_PERSISTENT_STORAGE</a>, 
<a class="el" href="group___engine.html#gga39cb91cd4d7e1de23713688ab4c575e0a802e58d3f757d3796362ee1f27f0e11b">ENGINE_FEATURE_SECONDARY_ENGINE</a>, 
<a class="el" href="group___engine.html#gga39cb91cd4d7e1de23713688ab4c575e0a74d64cc5cf04dfc8ae5eca77b29fc15a">ENGINE_FEATURE_ACCESS_CONTROL</a>, 
<br />
&#160;&#160;<b>ENGINE_FEATURE_MULTI_TENANCY</b>, 
<b>ENGINE_FEATURE_LRU</b>
<br />
 }</td></tr>
<tr class="separator:ga39cb91cd4d7e1de23713688ab4c575e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Most interesting here is to implement <a class="el" href="structengine__interface__v1.html">engine_interface_v1</a> for your engine. </p>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="ga8bb79ab44dc192cae02c9d50f89bc6e2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga8bb79ab44dc192cae02c9d50f89bc6e2">&#9670;&nbsp;</a></span>ADD_RESPONSE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef bool(* ADD_RESPONSE) (const void *key, uint16_t keylen, const void *ext, uint8_t extlen, const void *body, uint32_t bodylen, uint8_t datatype, uint16_t <a class="el" href="rem0rec_8cc.html#ad891b6122c6331f9c438fda0302a8d5e">status</a>, uint64_t cas, const void *cookie)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Callback for adding a response backet </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">key</td><td>The key to put in the response </td></tr>
    <tr><td class="paramname">keylen</td><td>The length of the key </td></tr>
    <tr><td class="paramname">ext</td><td>The data to put in the extended field in the response </td></tr>
    <tr><td class="paramname">extlen</td><td>The number of bytes in the ext field </td></tr>
    <tr><td class="paramname">body</td><td>The data body </td></tr>
    <tr><td class="paramname">bodylen</td><td>The number of bytes in the body </td></tr>
    <tr><td class="paramname">datatype</td><td>This is currently not used and should be set to 0 </td></tr>
    <tr><td class="paramname">status</td><td>The status code of the return packet (see in protocol_binary for the legal values) </td></tr>
    <tr><td class="paramname">cas</td><td>The cas to put in the return packet </td></tr>
    <tr><td class="paramname">cookie</td><td>The cookie provided by the frontend </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if return message was successfully created, false if an error occured that prevented the message from being sent </dd></dl>

</div>
</div>
<a id="gacd0112eec954e1e92962bc0d8aff5d96"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gacd0112eec954e1e92962bc0d8aff5d96">&#9670;&nbsp;</a></span>ADD_STAT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* ADD_STAT) (const char *key, const uint16_t klen, const char *val, const uint32_t vlen, const void *cookie)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Callback for any function producing stats.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">key</td><td>the stat's key </td></tr>
    <tr><td class="paramname">klen</td><td>length of the key </td></tr>
    <tr><td class="paramname">val</td><td>the stat's value in an ascii form (e.g. text form of a number) </td></tr>
    <tr><td class="paramname">vlen</td><td>length of the value </td></tr>
    <tr><td class="paramname">cookie</td><td>magic callback cookie </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga2cd1e92379a39a802320bd728201d0ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga2cd1e92379a39a802320bd728201d0ca">&#9670;&nbsp;</a></span>CREATE_INSTANCE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef ENGINE_ERROR_CODE(* CREATE_INSTANCE) (uint64_t interface, GET_SERVER_API get_server_api, <a class="el" href="structengine__interface.html">ENGINE_HANDLE</a> **handle)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The signature for the "create_instance" function exported from the module.</p>
<p>This function should fill out an engine inteface structure according to the interface parameter (Note: it is possible to return a lower version number).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">interface</td><td>The highest interface level the server supports </td></tr>
    <tr><td class="paramname">get_server_api</td><td>function to get the server API from </td></tr>
    <tr><td class="paramname">Where</td><td>to store the interface handle </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>See description of ENGINE_ERROR_CODE </dd></dl>

</div>
</div>
<a id="ga31b9874f683847a88a7318fbe1556ca2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga31b9874f683847a88a7318fbe1556ca2">&#9670;&nbsp;</a></span>ENGINE_HANDLE_V1</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structengine__interface__v1.html">engine_interface_v1</a>  <a class="el" href="group___engine.html#ga31b9874f683847a88a7318fbe1556ca2">ENGINE_HANDLE_V1</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Definition of the first version of the engine interface </p>

</div>
</div>
<a id="ga18337f714e9a050bc1bc9ba42d1ae42d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga18337f714e9a050bc1bc9ba42d1ae42d">&#9670;&nbsp;</a></span>TAP_ITERATOR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef tap_event_t(* TAP_ITERATOR) (<a class="el" href="structengine__interface.html">ENGINE_HANDLE</a> *handle, const void *cookie, item **item, void **engine_specific, uint16_t *nengine_specific, uint8_t *ttl, uint16_t *<a class="el" href="handler0alter_8cc.html#a4069e5feb5d17fbac4d832518d169cdd">flags</a>, uint32_t *seqno, uint16_t *vbucket)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>An iterator for the tap stream. The memcached core will keep on calling this function as long as a tap client is connected to the server. Each event returned by the iterator will be encoded in the binary protocol with the appropriate command opcode.</p>
<p>If the engine needs to store extra information in the tap stream it should do so by returning the data through the engine_specific pointer. This data should be valid for the core to use (read only) until the next invocation of the iterator, of if the connection is closed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">handle</td><td>the engine handle </td></tr>
    <tr><td class="paramname">cookie</td><td>identification for the tap stream </td></tr>
    <tr><td class="paramname">item</td><td>item to send returned here (check tap_event_t) </td></tr>
    <tr><td class="paramname">engine_specific</td><td>engine specific data returned here </td></tr>
    <tr><td class="paramname">nengine_specific</td><td>number of bytes of engine specific data </td></tr>
    <tr><td class="paramname">ttl</td><td>ttl for this item (Tap stream hops) </td></tr>
    <tr><td class="paramname">flags</td><td>tap flags for this object </td></tr>
    <tr><td class="paramname">seqno</td><td>sequence number to send </td></tr>
    <tr><td class="paramname">vbucket</td><td>the virtual bucket id </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the tap event to send (or TAP_PAUSE if there isn't any events) </dd></dl>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="ga39cb91cd4d7e1de23713688ab4c575e0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga39cb91cd4d7e1de23713688ab4c575e0">&#9670;&nbsp;</a></span>engine_feature_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="group___engine.html#ga39cb91cd4d7e1de23713688ab4c575e0">engine_feature_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="gga39cb91cd4d7e1de23713688ab4c575e0a2d032e66b79aa1f5a06fea36dc2ed844"></a>ENGINE_FEATURE_CAS&#160;</td><td class="fielddoc"><p>has compare-and-set operation </p>
</td></tr>
<tr><td class="fieldname"><a id="gga39cb91cd4d7e1de23713688ab4c575e0a1770c64b0aa502a874b044df9a2a1e6e"></a>ENGINE_FEATURE_PERSISTENT_STORAGE&#160;</td><td class="fielddoc"><p>has persistent storage support </p>
</td></tr>
<tr><td class="fieldname"><a id="gga39cb91cd4d7e1de23713688ab4c575e0a802e58d3f757d3796362ee1f27f0e11b"></a>ENGINE_FEATURE_SECONDARY_ENGINE&#160;</td><td class="fielddoc"><p>performs as pseudo engine </p>
</td></tr>
<tr><td class="fieldname"><a id="gga39cb91cd4d7e1de23713688ab4c575e0a74d64cc5cf04dfc8ae5eca77b29fc15a"></a>ENGINE_FEATURE_ACCESS_CONTROL&#160;</td><td class="fielddoc"><p>has access control feature </p>
</td></tr>
</table>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
