<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PERFORMANCE SCHEMA: sql/net_serv.cc File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PERFORMANCE SCHEMA
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_5bd71961b401a432086d0fb290a87f3f.html">sql</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">net_serv.cc File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;my_global.h&gt;</code><br />
<code>#include &lt;mysql.h&gt;</code><br />
<code>#include &lt;mysql_com.h&gt;</code><br />
<code>#include &lt;mysqld_error.h&gt;</code><br />
<code>#include &lt;my_sys.h&gt;</code><br />
<code>#include &lt;m_string.h&gt;</code><br />
<code>#include &lt;my_net.h&gt;</code><br />
<code>#include &lt;violite.h&gt;</code><br />
<code>#include &lt;signal.h&gt;</code><br />
<code>#include &lt;errno.h&gt;</code><br />
<code>#include &quot;probes_mysql.h&quot;</code><br />
<code>#include &lt;algorithm&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a5b872400e7ae3e61fc811a6dee4023b2"><td class="memItemLeft" align="right" valign="top"><a id="a5b872400e7ae3e61fc811a6dee4023b2"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>update_statistics</b>(A)</td></tr>
<tr class="separator:a5b872400e7ae3e61fc811a6dee4023b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb18611755c8b5d7e12fceeee266f082"><td class="memItemLeft" align="right" valign="top"><a id="afb18611755c8b5d7e12fceeee266f082"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>thd_increment_bytes_sent</b>(N)</td></tr>
<tr class="separator:afb18611755c8b5d7e12fceeee266f082"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b280d76dab64b5af4b6ea5684238f41"><td class="memItemLeft" align="right" valign="top"><a id="a5b280d76dab64b5af4b6ea5684238f41"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>VIO_SOCKET_ERROR</b>&#160;&#160;&#160;((size_t) -1)</td></tr>
<tr class="separator:a5b280d76dab64b5af4b6ea5684238f41"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a973c680573b37fc359fc68d0707da355"><td class="memItemLeft" align="right" valign="top"><a id="a973c680573b37fc359fc68d0707da355"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MAX_PACKET_LENGTH</b>&#160;&#160;&#160;(256L*256L*256L-1)</td></tr>
<tr class="separator:a973c680573b37fc359fc68d0707da355"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a0df7479d87e14d7472ae5f46bd68dcb3"><td class="memItemLeft" align="right" valign="top">static my_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="net__serv_8cc.html#a0df7479d87e14d7472ae5f46bd68dcb3">net_write_buff</a> (<a class="el" href="structst__net.html">NET</a> *, const uchar *, ulong)</td></tr>
<tr class="separator:a0df7479d87e14d7472ae5f46bd68dcb3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8fc6e3b92b7d8742b8ff93526b919063"><td class="memItemLeft" align="right" valign="top">my_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="net__serv_8cc.html#a8fc6e3b92b7d8742b8ff93526b919063">my_net_init</a> (<a class="el" href="structst__net.html">NET</a> *net, <a class="el" href="structst__vio.html">Vio</a> *vio)</td></tr>
<tr class="separator:a8fc6e3b92b7d8742b8ff93526b919063"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab71978513c49175a28c7ef3334a82250"><td class="memItemLeft" align="right" valign="top"><a id="ab71978513c49175a28c7ef3334a82250"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>net_end</b> (<a class="el" href="structst__net.html">NET</a> *net)</td></tr>
<tr class="separator:ab71978513c49175a28c7ef3334a82250"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1804171d7de40b147aff8de101cabe4d"><td class="memItemLeft" align="right" valign="top">my_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="net__serv_8cc.html#a1804171d7de40b147aff8de101cabe4d">net_realloc</a> (<a class="el" href="structst__net.html">NET</a> *net, size_t length)</td></tr>
<tr class="separator:a1804171d7de40b147aff8de101cabe4d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb9929fc40e34fe9f88dabe504a8921c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="net__serv_8cc.html#abb9929fc40e34fe9f88dabe504a8921c">net_clear</a> (<a class="el" href="structst__net.html">NET</a> *net, my_bool check_buffer <a class="el" href="trx0undo_8cc.html#aa965850120c0683c58e8c762cdc0fb17">__attribute__</a>((unused)))</td></tr>
<tr class="separator:abb9929fc40e34fe9f88dabe504a8921c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b25274dbacc2f6d54ce7efffe6c4d4b"><td class="memItemLeft" align="right" valign="top">my_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="net__serv_8cc.html#a8b25274dbacc2f6d54ce7efffe6c4d4b">net_flush</a> (<a class="el" href="structst__net.html">NET</a> *net)</td></tr>
<tr class="separator:a8b25274dbacc2f6d54ce7efffe6c4d4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad117bd75f64f6491b33544822da847a9"><td class="memItemLeft" align="right" valign="top">static my_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="net__serv_8cc.html#ad117bd75f64f6491b33544822da847a9">net_should_retry</a> (<a class="el" href="structst__net.html">NET</a> *net, uint *retry_count <a class="el" href="trx0undo_8cc.html#aa965850120c0683c58e8c762cdc0fb17">__attribute__</a>((unused)))</td></tr>
<tr class="separator:ad117bd75f64f6491b33544822da847a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae75e6bc59f4837011c9daf6aa4242de"><td class="memItemLeft" align="right" valign="top">my_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="net__serv_8cc.html#aae75e6bc59f4837011c9daf6aa4242de">my_net_write</a> (<a class="el" href="structst__net.html">NET</a> *net, const uchar *packet, size_t <a class="el" href="row0sel_8cc.html#abc67df9cd0bfdc52888bacc2e5097fdd">len</a>)</td></tr>
<tr class="separator:aae75e6bc59f4837011c9daf6aa4242de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b0d71007bd87af2b7dcf334afd13579"><td class="memItemLeft" align="right" valign="top">my_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="net__serv_8cc.html#a9b0d71007bd87af2b7dcf334afd13579">net_write_command</a> (<a class="el" href="structst__net.html">NET</a> *net, uchar command, const uchar *<a class="el" href="fsp0fsp_8cc.html#af17e72298b614d3ef0c0f311e7418e42">header</a>, size_t head_len, const uchar *packet, size_t <a class="el" href="row0sel_8cc.html#abc67df9cd0bfdc52888bacc2e5097fdd">len</a>)</td></tr>
<tr class="separator:a9b0d71007bd87af2b7dcf334afd13579"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a728ed8821728ffd1a0ec77a8e72baa3a"><td class="memItemLeft" align="right" valign="top">static my_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="net__serv_8cc.html#a728ed8821728ffd1a0ec77a8e72baa3a">net_write_raw_loop</a> (<a class="el" href="structst__net.html">NET</a> *net, const uchar *<a class="el" href="row0merge_8cc.html#ac7f6dbf32ec9428223e605e1b7f87bde">buf</a>, size_t count)</td></tr>
<tr class="separator:a728ed8821728ffd1a0ec77a8e72baa3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d44733dfa75ed45a7eddcffbe64b12b"><td class="memItemLeft" align="right" valign="top">static uchar *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="net__serv_8cc.html#a4d44733dfa75ed45a7eddcffbe64b12b">compress_packet</a> (<a class="el" href="structst__net.html">NET</a> *net, const uchar *packet, size_t *length)</td></tr>
<tr class="separator:a4d44733dfa75ed45a7eddcffbe64b12b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8de608589273d69563710b28bca4dd16"><td class="memItemLeft" align="right" valign="top">my_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="net__serv_8cc.html#a8de608589273d69563710b28bca4dd16">net_write_packet</a> (<a class="el" href="structst__net.html">NET</a> *net, const uchar *packet, size_t length)</td></tr>
<tr class="separator:a8de608589273d69563710b28bca4dd16"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af6a930f1ed9b8cce5be75f220ec73c33"><td class="memItemLeft" align="right" valign="top">static my_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="net__serv_8cc.html#af6a930f1ed9b8cce5be75f220ec73c33">net_read_raw_loop</a> (<a class="el" href="structst__net.html">NET</a> *net, size_t count)</td></tr>
<tr class="separator:af6a930f1ed9b8cce5be75f220ec73c33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c66d4994ccbf9b431074a79957fbbc9"><td class="memItemLeft" align="right" valign="top">static my_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="net__serv_8cc.html#a7c66d4994ccbf9b431074a79957fbbc9">net_read_packet_header</a> (<a class="el" href="structst__net.html">NET</a> *net)</td></tr>
<tr class="separator:a7c66d4994ccbf9b431074a79957fbbc9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91801941644600100fc253922765f24d"><td class="memItemLeft" align="right" valign="top">static ulong&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="net__serv_8cc.html#a91801941644600100fc253922765f24d">net_read_packet</a> (<a class="el" href="structst__net.html">NET</a> *net, size_t *complen)</td></tr>
<tr class="separator:a91801941644600100fc253922765f24d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95459c0280e24b9aacd761d0cc6ad749"><td class="memItemLeft" align="right" valign="top">ulong&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="net__serv_8cc.html#a95459c0280e24b9aacd761d0cc6ad749">my_net_read</a> (<a class="el" href="structst__net.html">NET</a> *net)</td></tr>
<tr class="separator:a95459c0280e24b9aacd761d0cc6ad749"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a813a0a36437c4c7f62b50fbb86617220"><td class="memItemLeft" align="right" valign="top"><a id="a813a0a36437c4c7f62b50fbb86617220"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>my_net_set_read_timeout</b> (<a class="el" href="structst__net.html">NET</a> *net, uint timeout)</td></tr>
<tr class="separator:a813a0a36437c4c7f62b50fbb86617220"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2256fff5962624fac7e47f8aec12402c"><td class="memItemLeft" align="right" valign="top"><a id="a2256fff5962624fac7e47f8aec12402c"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>my_net_set_write_timeout</b> (<a class="el" href="structst__net.html">NET</a> *net, uint timeout)</td></tr>
<tr class="separator:a2256fff5962624fac7e47f8aec12402c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file is the net layer API for the MySQL client/server protocol.</p>
<p>Write and read of logical packets to/from socket.</p>
<p>Writes are cached into net_buffer_length big packets. Read packets are reallocated dynamicly when reading big packets. Each logical packet has the following pre-info: 3 byte length &amp; 1 byte package-number.</p>
<p>This file needs to be written in C as it's used by the libmysql client as a C file. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a4d44733dfa75ed45a7eddcffbe64b12b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4d44733dfa75ed45a7eddcffbe64b12b">&#9670;&nbsp;</a></span>compress_packet()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uchar* compress_packet </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structst__net.html">NET</a> *&#160;</td>
          <td class="paramname"><em>net</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uchar *&#160;</td>
          <td class="paramname"><em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Compress and encapsulate a packet into a compressed packet.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">net</td><td>NET handler. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">packet</td><td>The packet to compress. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">length</td><td>Length of the packet.</td></tr>
  </table>
  </dd>
</dl>
<p>A compressed packet header is compromised of the packet length (3 bytes), packet number (1 byte) and the length of the original (uncompressed) packet.</p>
<dl class="section return"><dt>Returns</dt><dd>Pointer to the (new) compressed packet. </dd></dl>

</div>
</div>
<a id="a8fc6e3b92b7d8742b8ff93526b919063"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8fc6e3b92b7d8742b8ff93526b919063">&#9670;&nbsp;</a></span>my_net_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">my_bool my_net_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structst__net.html">NET</a> *&#160;</td>
          <td class="paramname"><em>net</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structst__vio.html">Vio</a> *&#160;</td>
          <td class="paramname"><em>vio</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Init with packet info. </p>

</div>
</div>
<a id="a95459c0280e24b9aacd761d0cc6ad749"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95459c0280e24b9aacd761d0cc6ad749">&#9670;&nbsp;</a></span>my_net_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ulong my_net_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structst__net.html">NET</a> *&#160;</td>
          <td class="paramname"><em>net</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Read a packet from the client/server and return it without the internal package header.</p>
<p>If the packet is the first packet of a multi-packet packet (which is indicated by the length of the packet = 0xffffff) then all sub packets are read and concatenated.</p>
<p>If the packet was compressed, its uncompressed and the length of the uncompressed packet is returned.</p>
<dl class="section return"><dt>Returns</dt><dd>The function returns the length of the found packet or packet_error. net-&gt;read_pos points to the read data. </dd></dl>

</div>
</div>
<a id="aae75e6bc59f4837011c9daf6aa4242de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aae75e6bc59f4837011c9daf6aa4242de">&#9670;&nbsp;</a></span>my_net_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">my_bool my_net_write </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structst__net.html">NET</a> *&#160;</td>
          <td class="paramname"><em>net</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uchar *&#160;</td>
          <td class="paramname"><em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Write a logical packet with packet header.</p>
<p>Format: Packet length (3 bytes), packet number (1 byte) When compression is used, a 3 byte compression length is added.</p>
<dl class="section note"><dt>Note</dt><dd>If compression is used, the original packet is modified! </dd></dl>

</div>
</div>
<a id="abb9929fc40e34fe9f88dabe504a8921c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb9929fc40e34fe9f88dabe504a8921c">&#9670;&nbsp;</a></span>net_clear()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void net_clear </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structst__net.html">NET</a> *&#160;</td>
          <td class="paramname"><em>net</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">my_bool check_buffer &#160;</td>
          <td class="paramname"><em>__attribute__</em>(unused)&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Clear (reinitialize) the NET structure for a new command.</p>
<dl class="section remark"><dt>Remarks</dt><dd>Performs debug checking of the socket buffer to ensure that the protocol sequence is correct.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">net</td><td>NET handler </td></tr>
    <tr><td class="paramname">check_buffer</td><td>Whether to check the socket buffer. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a8b25274dbacc2f6d54ce7efffe6c4d4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b25274dbacc2f6d54ce7efffe6c4d4b">&#9670;&nbsp;</a></span>net_flush()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">my_bool net_flush </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structst__net.html">NET</a> *&#160;</td>
          <td class="paramname"><em>net</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Flush write_buffer if not empty. </p>

</div>
</div>
<a id="a91801941644600100fc253922765f24d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a91801941644600100fc253922765f24d">&#9670;&nbsp;</a></span>net_read_packet()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static ulong net_read_packet </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structst__net.html">NET</a> *&#160;</td>
          <td class="paramname"><em>net</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>complen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Read one (variable-length) MySQL protocol packet. A MySQL packet consists of a header and a payload.</p>
<dl class="section remark"><dt>Remarks</dt><dd>Reads one packet to net-&gt;buff + net-&gt;where_b. </dd>
<dd>
Long packets are handled by <a class="el" href="net__serv_8cc.html#a95459c0280e24b9aacd761d0cc6ad749">my_net_read()</a>. </dd>
<dd>
The network buffer is expanded if necessary.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>The length of the packet, or  on error. </dd></dl>

</div>
</div>
<a id="a7c66d4994ccbf9b431074a79957fbbc9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c66d4994ccbf9b431074a79957fbbc9">&#9670;&nbsp;</a></span>net_read_packet_header()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static my_bool net_read_packet_header </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structst__net.html">NET</a> *&#160;</td>
          <td class="paramname"><em>net</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Read the header of a packet. The MySQL protocol packet header consists of the length, in bytes, of the payload (packet data) and a serial number.</p>
<dl class="section remark"><dt>Remarks</dt><dd>The encoded length is the length of the packet payload, which does not include the packet header.</dd>
<dd>
The serial number is used to ensure that the packets are received in order. If the packet serial number does not match the expected value, a error is returned.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">net</td><td>NET handler.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>TRUE on error, FALSE on success. </dd></dl>

</div>
</div>
<a id="af6a930f1ed9b8cce5be75f220ec73c33"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af6a930f1ed9b8cce5be75f220ec73c33">&#9670;&nbsp;</a></span>net_read_raw_loop()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static my_bool net_read_raw_loop </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structst__net.html">NET</a> *&#160;</td>
          <td class="paramname"><em>net</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>count</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Read a determined number of bytes from a network handler.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">net</td><td>NET handler. </td></tr>
    <tr><td class="paramname">count</td><td>The number of bytes to read.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>TRUE on error, FALSE on success. </dd></dl>

</div>
</div>
<a id="a1804171d7de40b147aff8de101cabe4d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1804171d7de40b147aff8de101cabe4d">&#9670;&nbsp;</a></span>net_realloc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">my_bool net_realloc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structst__net.html">NET</a> *&#160;</td>
          <td class="paramname"><em>net</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Realloc the packet buffer. </p>

</div>
</div>
<a id="ad117bd75f64f6491b33544822da847a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad117bd75f64f6491b33544822da847a9">&#9670;&nbsp;</a></span>net_should_retry()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static my_bool net_should_retry </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structst__net.html">NET</a> *&#160;</td>
          <td class="paramname"><em>net</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint *retry_count &#160;</td>
          <td class="paramname"><em>__attribute__</em>(unused)&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Whether a I/O operation should be retried later.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">net</td><td>NET handler. </td></tr>
    <tr><td class="paramname">retry_count</td><td>Maximum number of interrupted operations.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">TRUE</td><td>Operation should be retried. </td></tr>
    <tr><td class="paramname">FALSE</td><td>Operation should not be retried. Fatal error. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a0df7479d87e14d7472ae5f46bd68dcb3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0df7479d87e14d7472ae5f46bd68dcb3">&#9670;&nbsp;</a></span>net_write_buff()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static my_bool net_write_buff </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structst__net.html">NET</a> *&#160;</td>
          <td class="paramname"><em>net</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uchar *&#160;</td>
          <td class="paramname"><em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ulong&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Caching the data in a local buffer before sending it.</p>
<p>Fill up net-&gt;buffer and send it to the client when full.</p>
<p>If the rest of the to-be-sent-packet is bigger than buffer, send it in one big block (to avoid copying to internal buffer). If not, copy the rest of the data to the buffer and return without sending data.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">net</td><td>Network handler </td></tr>
    <tr><td class="paramname">packet</td><td>Packet to send </td></tr>
    <tr><td class="paramname">len</td><td>Length of packet</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>The cached buffer can be sent as it is with '<a class="el" href="net__serv_8cc.html#a8b25274dbacc2f6d54ce7efffe6c4d4b">net_flush()</a>'. In this code we have to be careful to not send a packet longer than MAX_PACKET_LENGTH to <a class="el" href="net__serv_8cc.html#a8de608589273d69563710b28bca4dd16">net_write_packet()</a> if we are using the compressed protocol as we store the length of the compressed packet in 3 bytes.</dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>ok </td></tr>
    <tr><td class="paramname">1</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a9b0d71007bd87af2b7dcf334afd13579"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9b0d71007bd87af2b7dcf334afd13579">&#9670;&nbsp;</a></span>net_write_command()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">my_bool net_write_command </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structst__net.html">NET</a> *&#160;</td>
          <td class="paramname"><em>net</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uchar&#160;</td>
          <td class="paramname"><em>command</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uchar *&#160;</td>
          <td class="paramname"><em>header</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>head_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uchar *&#160;</td>
          <td class="paramname"><em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Send a command to the server.</p>
<p>The reason for having both header and packet is so that libmysql can easy add a header to a special command (like prepared statements) without having to re-alloc the string.</p>
<p>As the command is part of the first data packet, we have to do some data juggling to put the command in there, without having to create a new packet.</p>
<p>This function will split big packets into sub-packets if needed. (Each sub packet can only be 2^24 bytes)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">net</td><td>NET handler </td></tr>
    <tr><td class="paramname">command</td><td>Command in MySQL server (enum enum_server_command) </td></tr>
    <tr><td class="paramname">header</td><td>Header to write after command </td></tr>
    <tr><td class="paramname">head_len</td><td>Length of header </td></tr>
    <tr><td class="paramname">packet</td><td>Query or parameter to query </td></tr>
    <tr><td class="paramname">len</td><td>Length of packet</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>ok </td></tr>
    <tr><td class="paramname">1</td><td>error </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a8de608589273d69563710b28bca4dd16"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8de608589273d69563710b28bca4dd16">&#9670;&nbsp;</a></span>net_write_packet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">my_bool net_write_packet </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structst__net.html">NET</a> *&#160;</td>
          <td class="paramname"><em>net</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uchar *&#160;</td>
          <td class="paramname"><em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Write a MySQL protocol packet to the network handler.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">net</td><td>NET handler. </td></tr>
    <tr><td class="paramname">packet</td><td>The packet to write. </td></tr>
    <tr><td class="paramname">length</td><td>Length of the packet.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section remark"><dt>Remarks</dt><dd>The packet might be encapsulated into a compressed packet.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>TRUE on error, FALSE on success. </dd></dl>

</div>
</div>
<a id="a728ed8821728ffd1a0ec77a8e72baa3a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a728ed8821728ffd1a0ec77a8e72baa3a">&#9670;&nbsp;</a></span>net_write_raw_loop()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static my_bool net_write_raw_loop </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structst__net.html">NET</a> *&#160;</td>
          <td class="paramname"><em>net</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uchar *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>count</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Write a determined number of bytes to a network handler.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">net</td><td>NET handler. </td></tr>
    <tr><td class="paramname">buf</td><td>Buffer containing the data to be written. </td></tr>
    <tr><td class="paramname">count</td><td>The length, in bytes, of the buffer.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>TRUE on error, FALSE on success. </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
