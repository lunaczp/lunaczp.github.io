<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PERFORMANCE SCHEMA: storage/innobase/include/buf0dblwr.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PERFORMANCE SCHEMA
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_70f20ecf11358dff00a0daf546d3147e.html">storage</a></li><li class="navelem"><a class="el" href="dir_3fec0aa9607ea05e0bb1c96aee1a8c4e.html">innobase</a></li><li class="navelem"><a class="el" href="dir_9b7ed1f29269ffabdc4c5f5522a0db25.html">include</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">buf0dblwr.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;univ.i&quot;</code><br />
<code>#include &quot;<a class="el" href="ut0byte_8h_source.html">ut0byte.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="log0log_8h_source.html">log0log.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="log0recv_8h_source.html">log0recv.h</a>&quot;</code><br />
</div>
<p><a href="buf0dblwr_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structbuf__dblwr__t.html">buf_dblwr_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ae04da9c9db457c394e73e851b4c6e9b9"><td class="memItemLeft" align="right" valign="top">UNIV_INTERN void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buf0dblwr_8h.html#ae04da9c9db457c394e73e851b4c6e9b9">buf_dblwr_create</a> (void)</td></tr>
<tr class="separator:ae04da9c9db457c394e73e851b4c6e9b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad26efaa199ea803573631d5e3ffb7ad7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buf0dblwr_8h.html#ad26efaa199ea803573631d5e3ffb7ad7">buf_dblwr_init_or_load_pages</a> (<a class="el" href="os0file_8h.html#a63fac270d46d4a195e833a6672729041">os_file_t</a> <a class="el" href="row0quiesce_8cc.html#a702945180aa732857b380a007a7e2a21">file</a>, char *path, bool load_corrupt_pages)</td></tr>
<tr class="separator:ad26efaa199ea803573631d5e3ffb7ad7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5353cb6d0c403c3345fba2c52618695c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buf0dblwr_8h.html#a5353cb6d0c403c3345fba2c52618695c">buf_dblwr_process</a> (void)</td></tr>
<tr class="separator:a5353cb6d0c403c3345fba2c52618695c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab38a1ad857f80aedfedb20060def6560"><td class="memItemLeft" align="right" valign="top">UNIV_INTERN void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buf0dblwr_8h.html#ab38a1ad857f80aedfedb20060def6560">buf_dblwr_free</a> (void)</td></tr>
<tr class="separator:ab38a1ad857f80aedfedb20060def6560"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aebaae47cdb7bef8e22f3e114f852890c"><td class="memItemLeft" align="right" valign="top">UNIV_INTERN void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buf0dblwr_8h.html#aebaae47cdb7bef8e22f3e114f852890c">buf_dblwr_update</a> (const <a class="el" href="structbuf__page__t.html">buf_page_t</a> *<a class="el" href="buf0lru_8cc.html#a9ffdaebdcefba1fd5f70092d43ca5d98">bpage</a>, <a class="el" href="buf0types_8h.html#a7b34944f1921a4bf7c1a28abfb86d73c">buf_flush_t</a> flush_type)</td></tr>
<tr class="separator:aebaae47cdb7bef8e22f3e114f852890c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58dec8fb6e33784d5b37f37a1d46fe47"><td class="memItemLeft" align="right" valign="top">UNIV_INTERN ibool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buf0dblwr_8h.html#a58dec8fb6e33784d5b37f37a1d46fe47">buf_dblwr_page_inside</a> (ulint <a class="el" href="ibuf0ibuf_8cc.html#a4856a6e725a44f73f3d7a0201373c5b7">page_no</a>)</td></tr>
<tr class="separator:a58dec8fb6e33784d5b37f37a1d46fe47"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd7745e181e732943f2149caad02e720"><td class="memItemLeft" align="right" valign="top">UNIV_INTERN void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buf0dblwr_8h.html#abd7745e181e732943f2149caad02e720">buf_dblwr_add_to_batch</a> (<a class="el" href="structbuf__page__t.html">buf_page_t</a> *<a class="el" href="buf0lru_8cc.html#a9ffdaebdcefba1fd5f70092d43ca5d98">bpage</a>)</td></tr>
<tr class="separator:abd7745e181e732943f2149caad02e720"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad42546734bec0119ef4bd40b93bf666"><td class="memItemLeft" align="right" valign="top">UNIV_INTERN void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buf0dblwr_8h.html#aad42546734bec0119ef4bd40b93bf666">buf_dblwr_flush_buffered_writes</a> (void)</td></tr>
<tr class="separator:aad42546734bec0119ef4bd40b93bf666"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73cf2f53e3e0581d5a538cbd492e27cf"><td class="memItemLeft" align="right" valign="top">UNIV_INTERN void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buf0dblwr_8h.html#a73cf2f53e3e0581d5a538cbd492e27cf">buf_dblwr_write_single_page</a> (<a class="el" href="structbuf__page__t.html">buf_page_t</a> *<a class="el" href="buf0lru_8cc.html#a9ffdaebdcefba1fd5f70092d43ca5d98">bpage</a>, bool <a class="el" href="ibuf0ibuf_8cc.html#a6265893dd43b2df4e241408f9e736f2e">sync</a>)</td></tr>
<tr class="separator:a73cf2f53e3e0581d5a538cbd492e27cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a9547ac40af85b7083c2c9fdcba791819"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structbuf__dblwr__t.html">buf_dblwr_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buf0dblwr_8h.html#a9547ac40af85b7083c2c9fdcba791819">buf_dblwr</a></td></tr>
<tr class="separator:a9547ac40af85b7083c2c9fdcba791819"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f6f8b03f4b009365d8dba1648695867"><td class="memItemLeft" align="right" valign="top">ibool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buf0dblwr_8h.html#a1f6f8b03f4b009365d8dba1648695867">buf_dblwr_being_created</a></td></tr>
<tr class="separator:a1f6f8b03f4b009365d8dba1648695867"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Doublewrite buffer module</p>
<p>Created 2011/12/19 Inaam Rana </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="abd7745e181e732943f2149caad02e720"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd7745e181e732943f2149caad02e720">&#9670;&nbsp;</a></span>buf_dblwr_add_to_batch()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UNIV_INTERN void buf_dblwr_add_to_batch </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structbuf__page__t.html">buf_page_t</a> *&#160;</td>
          <td class="paramname"><em>bpage</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Posts a buffer page for writing. If the doublewrite memory buffer is full, calls buf_dblwr_flush_buffered_writes and waits for for free space to appear. in: buffer block to write</p>
<p>Posts a buffer page for writing. If the doublewrite memory buffer is full, calls buf_dblwr_flush_buffered_writes and waits for for free space to appear. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bpage</td><td>in: buffer block to write </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ae04da9c9db457c394e73e851b4c6e9b9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae04da9c9db457c394e73e851b4c6e9b9">&#9670;&nbsp;</a></span>buf_dblwr_create()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UNIV_INTERN void buf_dblwr_create </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Creates the doublewrite buffer to a new InnoDB installation. The header of the doublewrite buffer is placed on the trx system header page. </p>

</div>
</div>
<a id="aad42546734bec0119ef4bd40b93bf666"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aad42546734bec0119ef4bd40b93bf666">&#9670;&nbsp;</a></span>buf_dblwr_flush_buffered_writes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UNIV_INTERN void buf_dblwr_flush_buffered_writes </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Flushes possible buffered writes from the doublewrite memory buffer to disk, and also wakes up the aio thread if simulated aio is used. It is very important to call this function after a batch of writes has been posted, and also when we may have to wait for a page latch! Otherwise a deadlock of threads can occur. </p>

</div>
</div>
<a id="ab38a1ad857f80aedfedb20060def6560"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab38a1ad857f80aedfedb20060def6560">&#9670;&nbsp;</a></span>buf_dblwr_free()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UNIV_INTERN void buf_dblwr_free </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>frees doublewrite buffer.</p>
<p>Frees doublewrite buffer. </p>

</div>
</div>
<a id="ad26efaa199ea803573631d5e3ffb7ad7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad26efaa199ea803573631d5e3ffb7ad7">&#9670;&nbsp;</a></span>buf_dblwr_init_or_load_pages()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void buf_dblwr_init_or_load_pages </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="os0file_8h.html#a63fac270d46d4a195e833a6672729041">os_file_t</a>&#160;</td>
          <td class="paramname"><em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>load_corrupt_pages</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>At a database startup initializes the doublewrite buffer memory structure if we already have a doublewrite buffer created in the data files. If we are upgrading to an InnoDB version which supports multiple tablespaces, then this function performs the necessary update operations. If we are in a crash recovery, this function loads the pages from double write buffer into memory. </p>

</div>
</div>
<a id="a58dec8fb6e33784d5b37f37a1d46fe47"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a58dec8fb6e33784d5b37f37a1d46fe47">&#9670;&nbsp;</a></span>buf_dblwr_page_inside()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UNIV_INTERN ibool buf_dblwr_page_inside </td>
          <td>(</td>
          <td class="paramtype">ulint&#160;</td>
          <td class="paramname"><em>page_no</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Determines if a page number is located inside the doublewrite buffer. </p><dl class="section return"><dt>Returns</dt><dd>TRUE if the location is inside the two blocks of the doublewrite buffer in: page number</dd></dl>
<p>Determines if a page number is located inside the doublewrite buffer. </p><dl class="section return"><dt>Returns</dt><dd>TRUE if the location is inside the two blocks of the doublewrite buffer </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">page_no</td><td>in: page number </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a5353cb6d0c403c3345fba2c52618695c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5353cb6d0c403c3345fba2c52618695c">&#9670;&nbsp;</a></span>buf_dblwr_process()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void buf_dblwr_process </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Process the double write buffer pages. </p>

</div>
</div>
<a id="aebaae47cdb7bef8e22f3e114f852890c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aebaae47cdb7bef8e22f3e114f852890c">&#9670;&nbsp;</a></span>buf_dblwr_update()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UNIV_INTERN void buf_dblwr_update </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structbuf__page__t.html">buf_page_t</a> *&#160;</td>
          <td class="paramname"><em>bpage</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="buf0types_8h.html#a7b34944f1921a4bf7c1a28abfb86d73c">buf_flush_t</a>&#160;</td>
          <td class="paramname"><em>flush_type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Updates the doublewrite buffer when an IO request is completed. in: flush type</p>
<p>Updates the doublewrite buffer when an IO request is completed. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bpage</td><td>in: buffer block descriptor </td></tr>
    <tr><td class="paramname">flush_type</td><td>in: flush type </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a73cf2f53e3e0581d5a538cbd492e27cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a73cf2f53e3e0581d5a538cbd492e27cf">&#9670;&nbsp;</a></span>buf_dblwr_write_single_page()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UNIV_INTERN void buf_dblwr_write_single_page </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structbuf__page__t.html">buf_page_t</a> *&#160;</td>
          <td class="paramname"><em>bpage</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>sync</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Writes a page to the doublewrite buffer on disk, sync it, then write the page to the datafile and sync the datafile. This function is used for single page flushes. If all the buffers allocated for single page flushes in the doublewrite buffer are in use we wait here for one to become free. We are guaranteed that a slot will become free because any thread that is using a slot must also release the slot before leaving this function. in: true if sync IO requested</p>
<p>Writes a page to the doublewrite buffer on disk, sync it, then write the page to the datafile and sync the datafile. This function is used for single page flushes. If all the buffers allocated for single page flushes in the doublewrite buffer are in use we wait here for one to become free. We are guaranteed that a slot will become free because any thread that is using a slot must also release the slot before leaving this function. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bpage</td><td>in: buffer block to write </td></tr>
    <tr><td class="paramname">sync</td><td>in: true if sync IO requested </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a9547ac40af85b7083c2c9fdcba791819"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9547ac40af85b7083c2c9fdcba791819">&#9670;&nbsp;</a></span>buf_dblwr</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structbuf__dblwr__t.html">buf_dblwr_t</a>* buf_dblwr</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Doublewrite system</p>
<p>The doublewrite buffer </p>

</div>
</div>
<a id="a1f6f8b03f4b009365d8dba1648695867"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f6f8b03f4b009365d8dba1648695867">&#9670;&nbsp;</a></span>buf_dblwr_being_created</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ibool buf_dblwr_being_created</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Set to TRUE when the doublewrite buffer is being created </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
