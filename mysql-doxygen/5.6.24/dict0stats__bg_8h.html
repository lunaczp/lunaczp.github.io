<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PERFORMANCE SCHEMA: storage/innobase/include/dict0stats_bg.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PERFORMANCE SCHEMA
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_70f20ecf11358dff00a0daf546d3147e.html">storage</a></li><li class="navelem"><a class="el" href="dir_3fec0aa9607ea05e0bb1c96aee1a8c4e.html">innobase</a></li><li class="navelem"><a class="el" href="dir_9b7ed1f29269ffabdc4c5f5522a0db25.html">include</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">dict0stats_bg.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;univ.i&quot;</code><br />
<code>#include &quot;<a class="el" href="dict0types_8h_source.html">dict0types.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="os0sync_8h_source.html">os0sync.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="os0thread_8h_source.html">os0thread.h</a>&quot;</code><br />
<code>#include &quot;dict0stats_bg.ic&quot;</code><br />
</div>
<p><a href="dict0stats__bg_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:af896626e64a1170547ab3050d29da8f7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dict0stats__bg_8h.html#af896626e64a1170547ab3050d29da8f7">DICT_STATS_BG_YIELD</a>(<a class="el" href="trx0trx_8cc.html#a33c6bd3ec7adfebaac8ed4906004b2ab">trx</a>)</td></tr>
<tr class="separator:af896626e64a1170547ab3050d29da8f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:acc483afed31ce1a69f099ebe5483a6dc"><td class="memItemLeft" align="right" valign="top">UNIV_INTERN void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dict0stats__bg_8h.html#acc483afed31ce1a69f099ebe5483a6dc">dict_stats_recalc_pool_add</a> (const <a class="el" href="structdict__table__t.html">dict_table_t</a> *<a class="el" href="row0upd_8cc.html#ab172ed3d3d31ff02fc5f798fe7e1bfb8">table</a>)</td></tr>
<tr class="separator:acc483afed31ce1a69f099ebe5483a6dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae8ab2829a348e3e07217892595f05a7f"><td class="memItemLeft" align="right" valign="top">UNIV_INTERN void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dict0stats__bg_8h.html#ae8ab2829a348e3e07217892595f05a7f">dict_stats_recalc_pool_del</a> (const <a class="el" href="structdict__table__t.html">dict_table_t</a> *<a class="el" href="row0upd_8cc.html#ab172ed3d3d31ff02fc5f798fe7e1bfb8">table</a>)</td></tr>
<tr class="separator:ae8ab2829a348e3e07217892595f05a7f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac22badd82facd7354a3b049dfba391a8"><td class="memItemLeft" align="right" valign="top">UNIV_INLINE bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dict0stats__bg_8h.html#ac22badd82facd7354a3b049dfba391a8">dict_stats_stop_bg</a> (<a class="el" href="structdict__table__t.html">dict_table_t</a> *<a class="el" href="row0upd_8cc.html#ab172ed3d3d31ff02fc5f798fe7e1bfb8">table</a>) <a class="el" href="trx0undo_8cc.html#aa965850120c0683c58e8c762cdc0fb17">__attribute__</a>((warn_unused_result))</td></tr>
<tr class="separator:ac22badd82facd7354a3b049dfba391a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31bf3f34e8eca410a1e09f42446cdac2"><td class="memItemLeft" align="right" valign="top">UNIV_INTERN void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dict0stats__bg_8h.html#a31bf3f34e8eca410a1e09f42446cdac2">dict_stats_wait_bg_to_stop_using_table</a> (<a class="el" href="structdict__table__t.html">dict_table_t</a> *<a class="el" href="row0upd_8cc.html#ab172ed3d3d31ff02fc5f798fe7e1bfb8">table</a>, <a class="el" href="structtrx__t.html">trx_t</a> *<a class="el" href="trx0trx_8cc.html#a33c6bd3ec7adfebaac8ed4906004b2ab">trx</a>)</td></tr>
<tr class="separator:a31bf3f34e8eca410a1e09f42446cdac2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a9a2ab7cc062a44dae800153b15ec55"><td class="memItemLeft" align="right" valign="top">UNIV_INTERN void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dict0stats__bg_8h.html#a8a9a2ab7cc062a44dae800153b15ec55">dict_stats_thread_init</a> ()</td></tr>
<tr class="separator:a8a9a2ab7cc062a44dae800153b15ec55"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3bdd81a8bc2296a94c3ae0cbfca226d"><td class="memItemLeft" align="right" valign="top">UNIV_INTERN void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dict0stats__bg_8h.html#ac3bdd81a8bc2296a94c3ae0cbfca226d">dict_stats_thread_deinit</a> ()</td></tr>
<tr class="separator:ac3bdd81a8bc2296a94c3ae0cbfca226d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a523211a82da8604edf8defc12ad48b42"><td class="memItemLeft" align="right" valign="top">UNIV_INTERN os_thread_ret_t <a class="el" href="os0thread_8h.html#a973a9b61391e09b9846b41b469363aa5">DECLARE_THREAD</a>()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dict0stats__bg_8h.html#a523211a82da8604edf8defc12ad48b42">dict_stats_thread</a> (void *arg)</td></tr>
<tr class="separator:a523211a82da8604edf8defc12ad48b42"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a075126a43d67e35dec3e4a5be5a5e838"><td class="memItemLeft" align="right" valign="top"><a class="el" href="os0sync_8h.html#ae24909be432e4a95bd956a707e4d1d20">os_event_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dict0stats__bg_8h.html#a075126a43d67e35dec3e4a5be5a5e838">dict_stats_event</a></td></tr>
<tr class="separator:a075126a43d67e35dec3e4a5be5a5e838"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Code used for background table and index stats gathering.</p>
<p>Created Apr 26, 2012 Vasil Dimov </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="af896626e64a1170547ab3050d29da8f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af896626e64a1170547ab3050d29da8f7">&#9670;&nbsp;</a></span>DICT_STATS_BG_YIELD</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DICT_STATS_BG_YIELD</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="trx0trx_8cc.html#a33c6bd3ec7adfebaac8ed4906004b2ab">trx</a></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordflow">do</span> {    \</div><div class="line">        row_mysql_unlock_data_dictionary(<a class="code" href="buf0lru_8cc.html#a696a6b0c51cd8ed2478a11f8c5f8405a">trx</a>);  \</div><div class="line">        os_thread_sleep(250000);                \</div><div class="line">        row_mysql_lock_data_dictionary(<a class="code" href="buf0lru_8cc.html#a696a6b0c51cd8ed2478a11f8c5f8405a">trx</a>);    \</div><div class="line">} <span class="keywordflow">while</span> (0)</div><div class="ttc" id="buf0lru_8cc_html_a696a6b0c51cd8ed2478a11f8c5f8405a"><div class="ttname"><a href="buf0lru_8cc.html#a696a6b0c51cd8ed2478a11f8c5f8405a">trx</a></div><div class="ttdeci">static ulint bool const trx_t * trx</div><div class="ttdef"><b>Definition:</b> buf0lru.cc:546</div></div>
</div><!-- fragment --><p>Yield the data dictionary latch when waiting for the background thread to stop accessing a table. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">trx</td><td>transaction holding the data dictionary locks </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="acc483afed31ce1a69f099ebe5483a6dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc483afed31ce1a69f099ebe5483a6dc">&#9670;&nbsp;</a></span>dict_stats_recalc_pool_add()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UNIV_INTERN void dict_stats_recalc_pool_add </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structdict__table__t.html">dict_table_t</a> *&#160;</td>
          <td class="paramname"><em>table</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Add a table to the recalc pool, which is processed by the background stats gathering thread. Only the table id is added to the list, so the table can be closed after being enqueued and it will be opened when needed. If the table does not exist later (has been DROPped), then it will be removed from the pool and skipped. in: table to add</p>
<p>Add a table to the recalc pool, which is processed by the background stats gathering thread. Only the table id is added to the list, so the table can be closed after being enqueued and it will be opened when needed. If the table does not exist later (has been DROPped), then it will be removed from the pool and skipped. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">table</td><td>in: table to add </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ae8ab2829a348e3e07217892595f05a7f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae8ab2829a348e3e07217892595f05a7f">&#9670;&nbsp;</a></span>dict_stats_recalc_pool_del()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UNIV_INTERN void dict_stats_recalc_pool_del </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structdict__table__t.html">dict_table_t</a> *&#160;</td>
          <td class="paramname"><em>table</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Delete a given table from the auto recalc pool. <a class="el" href="dict0stats__bg_8cc.html#ae8ab2829a348e3e07217892595f05a7f">dict_stats_recalc_pool_del()</a> in: table to remove</p>
<p>Delete a given table from the auto recalc pool. <a class="el" href="dict0stats__bg_8cc.html#ae8ab2829a348e3e07217892595f05a7f">dict_stats_recalc_pool_del()</a> </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">table</td><td>in: table to remove </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ac22badd82facd7354a3b049dfba391a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac22badd82facd7354a3b049dfba391a8">&#9670;&nbsp;</a></span>dict_stats_stop_bg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UNIV_INLINE bool dict_stats_stop_bg </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdict__table__t.html">dict_table_t</a> *&#160;</td>
          <td class="paramname"><em>table</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Request the background collection of statistics to stop for a table. </p><dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>when no background process is active </td></tr>
    <tr><td class="paramname">false</td><td>when it is not safe to modify the table definition </td></tr>
  </table>
  </dd>
</dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">table</td><td>in/out: table </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a523211a82da8604edf8defc12ad48b42"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a523211a82da8604edf8defc12ad48b42">&#9670;&nbsp;</a></span>dict_stats_thread()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UNIV_INTERN os_thread_ret_t <a class="el" href="os0thread_8h.html#a973a9b61391e09b9846b41b469363aa5">DECLARE_THREAD</a>() dict_stats_thread </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This is the thread for background stats gathering. It pops tables, from the auto recalc list and proceeds them, eventually recalculating their statistics. </p><dl class="section return"><dt>Returns</dt><dd>this function does not return, it calls <a class="el" href="os0thread_8h.html#a0fd49b8f981f8c7ee538d8b3937ed7ed">os_thread_exit()</a> in: a dummy parameter required by os_thread_create </dd></dl>

</div>
</div>
<a id="ac3bdd81a8bc2296a94c3ae0cbfca226d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac3bdd81a8bc2296a94c3ae0cbfca226d">&#9670;&nbsp;</a></span>dict_stats_thread_deinit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UNIV_INTERN void dict_stats_thread_deinit </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Free resources allocated by <a class="el" href="dict0stats__bg_8h.html#a8a9a2ab7cc062a44dae800153b15ec55">dict_stats_thread_init()</a>, must be called after <a class="el" href="dict0stats__bg_8h.html#a523211a82da8604edf8defc12ad48b42">dict_stats_thread()</a> has exited. </p>

</div>
</div>
<a id="a8a9a2ab7cc062a44dae800153b15ec55"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8a9a2ab7cc062a44dae800153b15ec55">&#9670;&nbsp;</a></span>dict_stats_thread_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UNIV_INTERN void dict_stats_thread_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialize global variables needed for the operation of <a class="el" href="dict0stats__bg_8cc.html#a1465f7e39bdc2f01a335ddd59a21bbcf">dict_stats_thread()</a>. Must be called before <a class="el" href="dict0stats__bg_8cc.html#a1465f7e39bdc2f01a335ddd59a21bbcf">dict_stats_thread()</a> is started.</p>
<p>Initialize global variables needed for the operation of <a class="el" href="dict0stats__bg_8cc.html#a1465f7e39bdc2f01a335ddd59a21bbcf">dict_stats_thread()</a> Must be called before <a class="el" href="dict0stats__bg_8cc.html#a1465f7e39bdc2f01a335ddd59a21bbcf">dict_stats_thread()</a> is started. </p>

</div>
</div>
<a id="a31bf3f34e8eca410a1e09f42446cdac2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a31bf3f34e8eca410a1e09f42446cdac2">&#9670;&nbsp;</a></span>dict_stats_wait_bg_to_stop_using_table()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UNIV_INTERN void dict_stats_wait_bg_to_stop_using_table </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdict__table__t.html">dict_table_t</a> *&#160;</td>
          <td class="paramname"><em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structtrx__t.html">trx_t</a> *&#160;</td>
          <td class="paramname"><em>trx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Wait until background stats thread has stopped using the specified table. The caller must have locked the data dictionary using row_mysql_lock_data_dictionary() and this function may unlock it temporarily and restore the lock before it exits. The background stats thread is guaranteed not to start using the specified table after this function returns and before the caller unlocks the data dictionary because it sets the BG_STAT_IN_PROGRESS bit in table-&gt;stats_bg_flag under dict_sys-&gt;mutex. in/out: transaction to use for unlocking/locking the data dict</p>
<p>Wait until background stats thread has stopped using the specified table. The caller must have locked the data dictionary using row_mysql_lock_data_dictionary() and this function may unlock it temporarily and restore the lock before it exits. The background stats thread is guaranteed not to start using the specified table after this function returns and before the caller unlocks the data dictionary because it sets the BG_STAT_IN_PROGRESS bit in table-&gt;stats_bg_flag under dict_sys-&gt;mutex. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">table</td><td>in/out: table </td></tr>
    <tr><td class="paramname">trx</td><td>in/out: transaction to use for unlocking/locking the data dict </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a075126a43d67e35dec3e4a5be5a5e838"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a075126a43d67e35dec3e4a5be5a5e838">&#9670;&nbsp;</a></span>dict_stats_event</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="os0sync_8h.html#ae24909be432e4a95bd956a707e4d1d20">os_event_t</a> dict_stats_event</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Event to wake up the stats thread </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
