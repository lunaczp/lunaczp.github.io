<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PERFORMANCE SCHEMA: Table_cache Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PERFORMANCE SCHEMA
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="#pri-static-attribs">Static Private Attributes</a> &#124;
<a href="class_table__cache-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">Table_cache Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="table__cache_8h_source.html">table_cache.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a24ff101df5431dc1fe69fd83f34db9f8"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_table__cache.html#a24ff101df5431dc1fe69fd83f34db9f8">init</a> ()</td></tr>
<tr class="separator:a24ff101df5431dc1fe69fd83f34db9f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a455cced61e30205fde43e97a40f7889b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_table__cache.html#a455cced61e30205fde43e97a40f7889b">destroy</a> ()</td></tr>
<tr class="separator:a455cced61e30205fde43e97a40f7889b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04900b8af1fb846ca4110593291c0447"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_table__cache.html#a04900b8af1fb846ca4110593291c0447">lock</a> ()</td></tr>
<tr class="separator:a04900b8af1fb846ca4110593291c0447"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a101b725dc04235f5be210378363a816c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_table__cache.html#a101b725dc04235f5be210378363a816c">unlock</a> ()</td></tr>
<tr class="separator:a101b725dc04235f5be210378363a816c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a60266ef71fbd59bdcc415880898fb1b4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_table__cache.html#a60266ef71fbd59bdcc415880898fb1b4">assert_owner</a> ()</td></tr>
<tr class="separator:a60266ef71fbd59bdcc415880898fb1b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c10638c72050587f37cb961f9477b16"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_t_a_b_l_e.html">TABLE</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_table__cache.html#a3c10638c72050587f37cb961f9477b16">get_table</a> (THD *<a class="el" href="row0quiesce_8cc.html#a75b6f5ba5a17ae9fb524f56a5eed51cb">thd</a>, my_hash_value_type hash_value, const char *key, uint key_length, <a class="el" href="struct_t_a_b_l_e___s_h_a_r_e.html">TABLE_SHARE</a> **share)</td></tr>
<tr class="separator:a3c10638c72050587f37cb961f9477b16"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44a41982d66f7084599befd4ad92f1b9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_table__cache.html#a44a41982d66f7084599befd4ad92f1b9">release_table</a> (THD *<a class="el" href="row0quiesce_8cc.html#a75b6f5ba5a17ae9fb524f56a5eed51cb">thd</a>, <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> *<a class="el" href="row0upd_8cc.html#ab172ed3d3d31ff02fc5f798fe7e1bfb8">table</a>)</td></tr>
<tr class="separator:a44a41982d66f7084599befd4ad92f1b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a74ea3cbfcab0314e4ef160979a2962"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_table__cache.html#a0a74ea3cbfcab0314e4ef160979a2962">add_used_table</a> (THD *<a class="el" href="row0quiesce_8cc.html#a75b6f5ba5a17ae9fb524f56a5eed51cb">thd</a>, <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> *<a class="el" href="row0upd_8cc.html#ab172ed3d3d31ff02fc5f798fe7e1bfb8">table</a>)</td></tr>
<tr class="separator:a0a74ea3cbfcab0314e4ef160979a2962"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6ac88435d0e282a272cb76836a68e7f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_table__cache.html#ae6ac88435d0e282a272cb76836a68e7f">remove_table</a> (<a class="el" href="struct_t_a_b_l_e.html">TABLE</a> *<a class="el" href="row0upd_8cc.html#ab172ed3d3d31ff02fc5f798fe7e1bfb8">table</a>)</td></tr>
<tr class="separator:ae6ac88435d0e282a272cb76836a68e7f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2d4ee1ea253452eb204577ce0111d0a"><td class="memItemLeft" align="right" valign="top">uint&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_table__cache.html#ac2d4ee1ea253452eb204577ce0111d0a">cached_tables</a> () const</td></tr>
<tr class="separator:ac2d4ee1ea253452eb204577ce0111d0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a761f02e59e45c74fdaf47815ed01ce09"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_table__cache.html#a761f02e59e45c74fdaf47815ed01ce09">free_all_unused_tables</a> ()</td></tr>
<tr class="separator:a761f02e59e45c74fdaf47815ed01ce09"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad83b8dd133dfe3b3091124d1a75ff693"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_table__cache.html#ad83b8dd133dfe3b3091124d1a75ff693">print_tables</a> ()</td></tr>
<tr class="separator:ad83b8dd133dfe3b3091124d1a75ff693"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:ab87a81918be08e180793e64050a94564"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_table__cache.html#ab87a81918be08e180793e64050a94564">init_psi_keys</a> ()</td></tr>
<tr class="separator:ab87a81918be08e180793e64050a94564"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a9169ec4ceefa6636a2cf7d543b270508"><td class="memItemLeft" align="right" valign="top"><a id="a9169ec4ceefa6636a2cf7d543b270508"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>check_unused</b> ()</td></tr>
<tr class="separator:a9169ec4ceefa6636a2cf7d543b270508"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3497b572cadf2f555c8db7f319e60c8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_table__cache.html#aa3497b572cadf2f555c8db7f319e60c8">link_unused_table</a> (<a class="el" href="struct_t_a_b_l_e.html">TABLE</a> *<a class="el" href="row0upd_8cc.html#ab172ed3d3d31ff02fc5f798fe7e1bfb8">table</a>)</td></tr>
<tr class="separator:aa3497b572cadf2f555c8db7f319e60c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb3c2fffd674221aad730713835ec104"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_table__cache.html#abb3c2fffd674221aad730713835ec104">unlink_unused_table</a> (<a class="el" href="struct_t_a_b_l_e.html">TABLE</a> *<a class="el" href="row0upd_8cc.html#ab172ed3d3d31ff02fc5f798fe7e1bfb8">table</a>)</td></tr>
<tr class="separator:abb3c2fffd674221aad730713835ec104"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc498d15a519e68686e9b324354f0d24"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_table__cache.html#afc498d15a519e68686e9b324354f0d24">free_unused_tables_if_necessary</a> (THD *<a class="el" href="row0quiesce_8cc.html#a75b6f5ba5a17ae9fb524f56a5eed51cb">thd</a>)</td></tr>
<tr class="separator:afc498d15a519e68686e9b324354f0d24"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a55b1c8ca81efc1876d28e9d4e5edb2ed"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group___thread__instrumentation.html#ga5303924710bf8356ede41ee68bca276f">mysql_mutex_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_table__cache.html#a55b1c8ca81efc1876d28e9d4e5edb2ed">m_lock</a></td></tr>
<tr class="separator:a55b1c8ca81efc1876d28e9d4e5edb2ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e7e04ccd3e7ff43a08c1ff3fcefa102"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structst__hash.html">HASH</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_table__cache.html#a6e7e04ccd3e7ff43a08c1ff3fcefa102">m_cache</a></td></tr>
<tr class="separator:a6e7e04ccd3e7ff43a08c1ff3fcefa102"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1bff528a663ef8463e51a604999fa96"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_t_a_b_l_e.html">TABLE</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_table__cache.html#aa1bff528a663ef8463e51a604999fa96">m_unused_tables</a></td></tr>
<tr class="separator:aa1bff528a663ef8463e51a604999fa96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ae7ed0813b43341e9245729d753acdc"><td class="memItemLeft" align="right" valign="top">uint&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_table__cache.html#a5ae7ed0813b43341e9245729d753acdc">m_table_count</a></td></tr>
<tr class="separator:a5ae7ed0813b43341e9245729d753acdc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-attribs"></a>
Static Private Attributes</h2></td></tr>
<tr class="memitem:acd0514fed908224cf7a1a089102ad588"><td class="memItemLeft" align="right" valign="top"><a id="acd0514fed908224cf7a1a089102ad588"></a>
static <a class="el" href="group___instrumentation__interface.html#gaab1542573f750448abe64c7dc3f3b819">PSI_mutex_key</a>&#160;</td><td class="memItemRight" valign="bottom"><b>m_lock_key</b></td></tr>
<tr class="separator:acd0514fed908224cf7a1a089102ad588"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3e4b9c6c534d4b058ba4147a3276843"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="group___instrumentation__interface.html#ga71c1548fde9983df2427c2ddc97085a9">PSI_mutex_info</a>&#160;</td><td class="memItemRight" valign="bottom"><b>m_mutex_keys</b> []</td></tr>
<tr class="separator:aa3e4b9c6c534d4b058ba4147a3276843"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Cache for open <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> objects.</p>
<p>The idea behind this cache is that most statements don't need to go to a central table definition cache to get a <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> object and therefore don't need to lock LOCK_open mutex. Instead they only need to go to one <a class="el" href="class_table__cache.html">Table_cache</a> instance (the specific instance is determined by thread id) and only lock the mutex protecting this cache. DDL statements that need to remove all <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> objects from all caches need to lock mutexes for all <a class="el" href="class_table__cache.html">Table_cache</a> instances, but they are rare.</p>
<p>This significantly increases scalability in some scenarios. </p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="a0a74ea3cbfcab0314e4ef160979a2962"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a74ea3cbfcab0314e4ef160979a2962">&#9670;&nbsp;</a></span>add_used_table()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool Table_cache::add_used_table </td>
          <td>(</td>
          <td class="paramtype">THD *&#160;</td>
          <td class="paramname"><em>thd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_t_a_b_l_e.html">TABLE</a> *&#160;</td>
          <td class="paramname"><em>table</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Add newly created <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> object which is going to be used right away to the table cache.</p>
<dl class="section note"><dt>Note</dt><dd>Caller should own lock on the table cache.</dd>
<dd>
Sets TABLE::in_use member as side effect.</dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">false</td><td>- success. </td></tr>
    <tr><td class="paramname">true</td><td>- failure. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a60266ef71fbd59bdcc415880898fb1b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a60266ef71fbd59bdcc415880898fb1b4">&#9670;&nbsp;</a></span>assert_owner()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Table_cache::assert_owner </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Assert that caller owns lock on the table cache. </p>

</div>
</div>
<a id="ac2d4ee1ea253452eb204577ce0111d0a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac2d4ee1ea253452eb204577ce0111d0a">&#9670;&nbsp;</a></span>cached_tables()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint Table_cache::cached_tables </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get number of <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> instances in the cache. </p>

</div>
</div>
<a id="a455cced61e30205fde43e97a40f7889b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a455cced61e30205fde43e97a40f7889b">&#9670;&nbsp;</a></span>destroy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Table_cache::destroy </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Destroy instance of table cache. </p>

</div>
</div>
<a id="a761f02e59e45c74fdaf47815ed01ce09"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a761f02e59e45c74fdaf47815ed01ce09">&#9670;&nbsp;</a></span>free_all_unused_tables()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Table_cache::free_all_unused_tables </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Free all unused <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> objects in the table cache. </p>

</div>
</div>
<a id="afc498d15a519e68686e9b324354f0d24"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc498d15a519e68686e9b324354f0d24">&#9670;&nbsp;</a></span>free_unused_tables_if_necessary()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Table_cache::free_unused_tables_if_necessary </td>
          <td>(</td>
          <td class="paramtype">THD *&#160;</td>
          <td class="paramname"><em>thd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Free unused <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> instances if total number of <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> objects in table cache has exceeded table_cache_size_per_instance limit.</p>
<dl class="section note"><dt>Note</dt><dd>That we might need to free more than one instance during this call if table_cache_size was changed dynamically. </dd></dl>

</div>
</div>
<a id="a3c10638c72050587f37cb961f9477b16"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c10638c72050587f37cb961f9477b16">&#9670;&nbsp;</a></span>get_table()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_t_a_b_l_e.html">TABLE</a> * Table_cache::get_table </td>
          <td>(</td>
          <td class="paramtype">THD *&#160;</td>
          <td class="paramname"><em>thd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">my_hash_value_type&#160;</td>
          <td class="paramname"><em>hash_value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint&#160;</td>
          <td class="paramname"><em>key_length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_t_a_b_l_e___s_h_a_r_e.html">TABLE_SHARE</a> **&#160;</td>
          <td class="paramname"><em>share</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get an unused <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> instance from the table cache.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">thd</td><td>Thread context. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">hash_value</td><td>Hash value for the key identifying table. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">key</td><td><a class="el" href="class_key.html">Key</a> identifying table. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">key_length</td><td>Length of key for the table. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">share</td><td>NULL - if table cache doesn't contain any information about the table (i.e. doesn't have neither used nor unused <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> objects for it). Pointer to <a class="el" href="struct_t_a_b_l_e___s_h_a_r_e.html">TABLE_SHARE</a> for the table otherwise.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Caller should own lock on the table cache. </dd>
<dd>
Sets TABLE::in_use member as side effect.</dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">non-NULL</td><td>- pointer to unused <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> object, "share" out-parameter contains pointer to <a class="el" href="struct_t_a_b_l_e___s_h_a_r_e.html">TABLE_SHARE</a> for this table. </td></tr>
    <tr><td class="paramname">NULL</td><td>- no unused <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> object was found, "share" parameter contains pointer to <a class="el" href="struct_t_a_b_l_e___s_h_a_r_e.html">TABLE_SHARE</a> for this table if there are used <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> objects in cache and NULL otherwise. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a24ff101df5431dc1fe69fd83f34db9f8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a24ff101df5431dc1fe69fd83f34db9f8">&#9670;&nbsp;</a></span>init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Table_cache::init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialize instance of table cache.</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">false</td><td>- success. </td></tr>
    <tr><td class="paramname">true</td><td>- failure. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ab87a81918be08e180793e64050a94564"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab87a81918be08e180793e64050a94564">&#9670;&nbsp;</a></span>init_psi_keys()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Table_cache::init_psi_keys </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Init P_S instrumentation key for mutex protecting <a class="el" href="class_table__cache.html">Table_cache</a> instance. </p>

</div>
</div>
<a id="aa3497b572cadf2f555c8db7f319e60c8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa3497b572cadf2f555c8db7f319e60c8">&#9670;&nbsp;</a></span>link_unused_table()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Table_cache::link_unused_table </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_t_a_b_l_e.html">TABLE</a> *&#160;</td>
          <td class="paramname"><em>table</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Add table to the tail of unused tables list for table cache (i.e. as the most recently used table in this list). </p>

</div>
</div>
<a id="a04900b8af1fb846ca4110593291c0447"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a04900b8af1fb846ca4110593291c0447">&#9670;&nbsp;</a></span>lock()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Table_cache::lock </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Acquire lock on table cache instance. </p>

</div>
</div>
<a id="ad83b8dd133dfe3b3091124d1a75ff693"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad83b8dd133dfe3b3091124d1a75ff693">&#9670;&nbsp;</a></span>print_tables()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Table_cache::print_tables </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Print debug information for the contents of the table cache. </p>

</div>
</div>
<a id="a44a41982d66f7084599befd4ad92f1b9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44a41982d66f7084599befd4ad92f1b9">&#9670;&nbsp;</a></span>release_table()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Table_cache::release_table </td>
          <td>(</td>
          <td class="paramtype">THD *&#160;</td>
          <td class="paramname"><em>thd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_t_a_b_l_e.html">TABLE</a> *&#160;</td>
          <td class="paramname"><em>table</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Put used <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> instance back to the table cache and mark it as unused.</p>
<dl class="section note"><dt>Note</dt><dd>Caller should own lock on the table cache. </dd>
<dd>
Sets TABLE::in_use member as side effect. </dd></dl>

</div>
</div>
<a id="ae6ac88435d0e282a272cb76836a68e7f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae6ac88435d0e282a272cb76836a68e7f">&#9670;&nbsp;</a></span>remove_table()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Table_cache::remove_table </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_t_a_b_l_e.html">TABLE</a> *&#160;</td>
          <td class="paramname"><em>table</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Prepare used or unused <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> instance for destruction by removing it from the table cache.</p>
<dl class="section note"><dt>Note</dt><dd>Caller should own lock on the table cache. </dd></dl>

</div>
</div>
<a id="abb3c2fffd674221aad730713835ec104"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb3c2fffd674221aad730713835ec104">&#9670;&nbsp;</a></span>unlink_unused_table()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Table_cache::unlink_unused_table </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_t_a_b_l_e.html">TABLE</a> *&#160;</td>
          <td class="paramname"><em>table</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Remove table from the unused tables list for table cache. </p>

</div>
</div>
<a id="a101b725dc04235f5be210378363a816c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a101b725dc04235f5be210378363a816c">&#9670;&nbsp;</a></span>unlock()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Table_cache::unlock </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Release lock on table cache instance. </p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a6e7e04ccd3e7ff43a08c1ff3fcefa102"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e7e04ccd3e7ff43a08c1ff3fcefa102">&#9670;&nbsp;</a></span>m_cache</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structst__hash.html">HASH</a> Table_cache::m_cache</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>The hash of <a class="el" href="class_table__cache__element.html">Table_cache_element</a> objects, each table/table share that has any <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> object in the <a class="el" href="class_table__cache.html">Table_cache</a> has a <a class="el" href="class_table__cache__element.html">Table_cache_element</a> from which the list of free <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> objects in this table cache AND the list of used <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> objects in this table cache is stored. We use Table_cache_element::share::table_cache_key as key for this hash. </p>

</div>
</div>
<a id="a55b1c8ca81efc1876d28e9d4e5edb2ed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a55b1c8ca81efc1876d28e9d4e5edb2ed">&#9670;&nbsp;</a></span>m_lock</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group___thread__instrumentation.html#ga5303924710bf8356ede41ee68bca276f">mysql_mutex_t</a> Table_cache::m_lock</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>The table cache lock protects the following data:</p>
<p>1) m_unused_tables list. 2) m_cache hash. 3) used_tables, free_tables lists in <a class="el" href="class_table__cache__element.html">Table_cache_element</a> objects in this cache. 4) m_table_count - total number of <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> objects in this cache. 5) the element in <a class="el" href="struct_t_a_b_l_e___s_h_a_r_e.html#a0b2d66b9a33c0007107a15690955b44f">TABLE_SHARE::cache_element</a>[] array that corresponds to this cache, 6) in_use member in <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> object. 7) Also ownership of mutexes for all caches are required to update the refresh_version and table_def_shutdown_in_progress variables and <a class="el" href="struct_t_a_b_l_e___s_h_a_r_e.html#ae04c033776f1dc39863ebf60b842c505">TABLE_SHARE::version</a> member.</p>
<p>The intention is that any query that finds a cached table object in its designated table cache should only need to lock this mutex instance and there should be no need to lock LOCK_open. LOCK_open is still required however to create and release <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> objects. However most usage of the MySQL Server should be able to set the cache size big enough so that the majority of the queries only need to lock this mutex instance and not LOCK_open. </p>

</div>
</div>
<a id="aa3e4b9c6c534d4b058ba4147a3276843"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa3e4b9c6c534d4b058ba4147a3276843">&#9670;&nbsp;</a></span>m_mutex_keys</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group___instrumentation__interface.html#ga71c1548fde9983df2427c2ddc97085a9">PSI_mutex_info</a> Table_cache::m_mutex_keys</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div><div class="line">  { &amp;m_lock_key, <span class="stringliteral">&quot;LOCK_table_cache&quot;</span>, 0}</div><div class="line">}</div></div><!-- fragment -->
</div>
</div>
<a id="a5ae7ed0813b43341e9245729d753acdc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ae7ed0813b43341e9245729d753acdc">&#9670;&nbsp;</a></span>m_table_count</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint Table_cache::m_table_count</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Total number of <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> instances for tables in this particular table cache (both in use by threads and not in use). This value summed over all table caches is accessible to users as Open_tables status variable. </p>

</div>
</div>
<a id="aa1bff528a663ef8463e51a604999fa96"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa1bff528a663ef8463e51a604999fa96">&#9670;&nbsp;</a></span>m_unused_tables</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_t_a_b_l_e.html">TABLE</a>* Table_cache::m_unused_tables</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p><a class="el" href="class_list.html">List</a> that contains all <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> instances for tables in this particular table cache that are in not use by any thread. Recently used <a class="el" href="struct_t_a_b_l_e.html">TABLE</a> instances are appended to the end of the list. Thus the beginning of the list contains which have been least recently used. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>sql/<a class="el" href="table__cache_8h_source.html">table_cache.h</a></li>
<li>sql/table_cache.cc</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
